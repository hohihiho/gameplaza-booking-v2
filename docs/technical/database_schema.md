# 🗄️ 데이터베이스 구조 설계서

> 💡 **초보자를 위한 설명**: 데이터베이스는 우리 서비스의 모든 정보를 체계적으로 저장하는 창고입니다. 
> 마치 엑셀 파일처럼 표(테이블) 형태로 정보를 관리합니다.

## 📊 전체 구조 한눈에 보기

```
GamePlaza 데이터베이스
│
├── 👤 사용자 관련
│   ├── users (회원 정보)
│   └── blacklist (블랙리스트)
│
├── 🎮 기기 관련
│   ├── machines (전체 기기 목록)
│   └── rental_machines (대여 가능 기기)
│
├── 📅 예약 관련
│   ├── reservations (예약 내역)
│   ├── check_ins (체크인 기록)
│   └── payments (결제 정보)
│
└── 🔧 관리 관련
    ├── admin_logs (관리자 활동 기록)
    ├── content_pages (콘텐츠 페이지)
    └── notifications (알림 내역)
```

## 📋 각 테이블 상세 설명

### 1. 👤 **users** - 회원 정보
> 우리 서비스를 사용하는 모든 회원의 정보를 저장합니다.

| 필드명 | 설명 | 예시 |
|--------|------|------|
| `id` | 회원 고유번호 | "user_123456" |
| `email` | 구글 이메일 | "kim@gmail.com" |
| `name` | 닉네임 (변경 가능) | "게임왕철수" |
| `phone` | 전화번호 | "010-1234-5678" |
| `phone_verified` | 전화번호 인증 여부 | true/false |
| `role` | 권한 (일반/스태프/관리자) | "user", "staff", "admin" |
| `created_at` | 가입일 | "2024-01-15" |
| `last_login` | 마지막 로그인 | "2024-01-20 14:30" |
| `is_blacklisted` | 블랙리스트 여부 | true/false |

### 2. 🎮 **machines** - 전체 기기 목록
> 게임플라자가 보유한 모든 게임기의 정보입니다.

| 필드명 | 설명 | 예시 |
|--------|------|------|
| `id` | 기기 고유번호 | "machine_001" |
| `machine_number` | 기기 번호 (관리자 설정) | "철권-1", "리듬-3" |
| `name` | 기기명 | "철권 8" |
| `type` | 기기 종류 | "격투게임" |
| `status` | 상태 | "정상", "수리중", "고장" |
| `purchase_date` | 구입일 | "2023-12-01" |
| `maintenance_date` | 마지막 점검일 | "2024-01-10" |

### 3. 🎯 **rental_machines** - 대여 가능 기기
> 일반 사용자가 예약할 수 있는 기기 목록입니다.

| 필드명 | 설명 | 예시 |
|--------|------|------|
| `id` | 대여기기 고유번호 | "rental_001" |
| `machine_id` | 실제 기기 번호 | "machine_001" |
| `display_name` | 표시 이름 (관리자 설정) | "철권 8 (2P석)", "리듬게임 3번" |
| `hourly_rate` | 시간당 요금 | 5000 |
| `min_hours` | 최소 대여시간 | 2 |
| `max_hours` | 최대 대여시간 | 4 |
| `is_active` | 대여 가능 여부 | true/false |
| `description` | 설명 | "최신 철권 시리즈" |
| `image_url` | 이미지 주소 | "https://..." |

### 4. 📅 **reservations** - 예약 내역
> 모든 예약 신청과 처리 내역을 관리합니다.

| 필드명 | 설명 | 예시 |
|--------|------|------|
| `id` | 예약 번호 | "res_20240120_001" |
| `user_id` | 예약자 | "user_123456" |
| `machine_id` | 예약 기기 | "rental_001" |
| `date` | 예약일 | "2024-01-25" |
| `start_time` | 시작 시간 | "14:00" |
| `end_time` | 종료 시간 | "16:00" |
| `hours` | 이용 시간 | 2 |
| `total_amount` | 총 금액 | 10000 |
| `status` | 상태 | "대기중", "승인", "거절", "체크인", "완료", "취소" |
| `created_at` | 신청일시 | "2024-01-20 10:30" |
| `approved_at` | 승인일시 | "2024-01-20 11:00" |
| `approved_by` | 승인한 관리자 | "admin_001" |
| `rejection_reason` | 거절 사유 | "해당 시간 이미 예약됨" |
| `notes` | 메모 | "단골 고객" |

### 5. ✅ **check_ins** - 체크인 기록
> 실제 방문하여 체크인한 기록입니다.

| 필드명 | 설명 | 예시 |
|--------|------|------|
| `id` | 체크인 번호 | "checkin_001" |
| `reservation_id` | 예약 번호 | "res_20240120_001" |
| `checked_in_at` | 체크인 시간 | "2024-01-25 14:05" |
| `checked_in_by` | 체크인 처리자 | "staff_002" |
| `payment_sent` | 계좌번호 전송 여부 | true/false |

### 6. 💰 **payments** - 결제 정보
> 결제 관련 정보를 저장합니다.

| 필드명 | 설명 | 예시 |
|--------|------|------|
| `id` | 결제 번호 | "pay_001" |
| `reservation_id` | 예약 번호 | "res_20240120_001" |
| `amount` | 금액 | 10000 |
| `method` | 결제 방법 | "계좌이체" |
| `status` | 상태 | "대기중", "완료", "취소" |
| `paid_at` | 결제 완료일 | "2024-01-25 14:10" |
| `bank_name` | 은행명 | "카카오뱅크" |
| `account_number` | 계좌번호 | "3333-01-1234567" |

### 7. 🚫 **blacklist** - 블랙리스트
> 이용 제한된 사용자의 정보입니다.

| 필드명 | 설명 | 예시 |
|--------|------|------|
| `id` | 번호 | "black_001" |
| `email_hash` | 이메일 해시값 | "a1b2c3d4..." |
| `reason` | 사유 | "노쇼 3회 이상" |
| `blocked_at` | 차단일 | "2024-01-15" |
| `blocked_by` | 처리 관리자 | "admin_001" |
| `unblock_date` | 해제 예정일 | "2027-01-15" |

> 💡 **개인정보 보호**: 실제 이메일 대신 해시값으로 저장하여 개인정보를 보호합니다.

### 8. 📝 **admin_logs** - 관리자 활동 기록
> 관리자가 수행한 모든 작업을 기록합니다.

| 필드명 | 설명 | 예시 |
|--------|------|------|
| `id` | 로그 번호 | "log_001" |
| `admin_id` | 관리자 번호 | "admin_001" |
| `action` | 작업 내용 | "예약 승인" |
| `target_type` | 대상 종류 | "reservation" |
| `target_id` | 대상 번호 | "res_20240120_001" |
| `details` | 상세 내용 | "철권8 예약 승인 처리" |
| `ip_address` | IP 주소 | "192.168.1.1" |
| `created_at` | 작업 시간 | "2024-01-20 11:00" |

### 9. 📄 **content_pages** - 콘텐츠 페이지
> 노코드 빌더로 만든 페이지 정보입니다.

| 필드명 | 설명 | 예시 |
|--------|------|------|
| `id` | 페이지 번호 | "page_001" |
| `slug` | 주소 | "event-2024" |
| `title` | 제목 | "2024년 신년 이벤트" |
| `content` | 내용 (JSON) | {"blocks": [...]} |
| `is_published` | 공개 여부 | true/false |
| `created_by` | 작성자 | "admin_001" |
| `created_at` | 작성일 | "2024-01-01" |
| `updated_at` | 수정일 | "2024-01-05" |

### 10. 📱 **notifications** - 알림 내역
> 사용자에게 전송된 모든 알림 기록입니다.

| 필드명 | 설명 | 예시 |
|--------|------|------|
| `id` | 알림 번호 | "noti_001" |
| `user_id` | 받는 사람 | "user_123456" |
| `type` | 알림 종류 | "예약승인", "체크인", "공지사항" |
| `title` | 제목 | "예약이 승인되었습니다" |
| `message` | 내용 | "1월 25일 철권8 예약..." |
| `is_read` | 읽음 여부 | true/false |
| `sent_at` | 전송 시간 | "2024-01-20 11:00" |
| `fcm_token` | FCM 토큰 | "fcm_token_string..." |

## 🔗 테이블 간의 관계

### 쉽게 이해하는 관계도
```
👤 사용자(users)가
    ↓
📅 예약(reservations)을 신청하면
    ↓
👮 관리자가 승인/거절하고
    ↓
✅ 체크인(check_ins) 시 
    ↓
💰 결제(payments) 정보를 받아요
```

### 주요 연결 관계
1. **사용자 → 예약**: 한 사용자가 여러 예약 가능
2. **예약 → 체크인**: 하나의 예약당 하나의 체크인
3. **예약 → 결제**: 하나의 예약당 하나의 결제
4. **기기 → 대여기기**: 실제 기기를 대여용으로 등록
5. **대여기기 → 예약**: 하나의 대여기기에 여러 예약 가능

## 🛡️ 보안 설정

### RLS (Row Level Security) - 행 수준 보안
> 💡 각 사용자가 자신의 데이터만 볼 수 있도록 제한합니다.

- **일반 사용자**: 자신의 예약, 결제 정보만 조회 가능
- **스태프**: 체크인 관련 정보 조회/수정 가능
- **관리자**: 모든 데이터 조회/수정 가능

### 인덱스 설정
> 💡 자주 검색하는 항목을 빠르게 찾을 수 있도록 색인을 만듭니다.

- 예약 날짜별 검색을 위한 인덱스
- 사용자별 예약 조회를 위한 인덱스
- 기기별 예약 현황 조회를 위한 인덱스

## 📈 데이터 백업 정책

1. **자동 백업**: 매일 새벽 3시 자동 백업
2. **백업 보관**: 최근 30일간의 백업 보관
3. **복구 시간**: 문제 발생 시 1시간 이내 복구

## 🔍 자주 사용하는 데이터 조회 예시

### 1. "오늘 예약 현황 보기"
```
오늘 날짜의 모든 예약을 시간순으로 정렬해서 보여줍니다.
```

### 2. "특정 사용자의 예약 이력"
```
해당 사용자의 모든 예약을 최신순으로 보여줍니다.
```

### 3. "이번 달 매출 통계"
```
이번 달 완료된 모든 결제의 합계를 계산합니다.
```

---

> 📌 **참고**: 이 문서는 개발자가 실제 데이터베이스를 구축할 때 참고하는 설계도입니다. 
> 실제 운영 중에 필요에 따라 수정될 수 있습니다.