# 광주 게임플라자 운영일정 관리 시스템 기획서

## 개요
특별 운영 시간, 예약 제한, 이벤트 등 운영 일정을 효율적으로 관리하고 예약 현황을 시각적으로 표시하는 시스템

## 최종 업데이트: 2025-07-14

## 🕐 시간대 설정 기본 원칙
**모든 시간은 한국 표준시(KST, UTC+9)를 기준으로 합니다.**
- 날짜 표시: YYYY-MM-DD 형식
- 시간 표시: 24시간제 (00:00 ~ 23:59)
- 새벽 시간: 24:00 이후는 익일로 표시 (예: 01월 15일 25:00 = 01월 16일 01:00)
- 데이터베이스 저장: KST 기준
- API 통신: KST 기준
- 프론트엔드 표시: KST 기준

## 주요 기능

### 1. 운영 일정 유형
1. **특별 운영**: 기본 운영 시간과 다른 특별 운영 시간 설정
2. **조기 오픈**: 평소보다 일찍 오픈하는 날
3. **밤샘 영업**: 새벽까지 연장 영업하는 날
4. **조기 마감**: 평소보다 일찍 마감하는 날
5. **이벤트**: 특별 이벤트 일정
6. **예약 제한**: 특정 날짜/기간의 예약을 제한

### 2. 예약 제한 기능
- **제한 범위 선택**
  - 조기 대여 제한: 조기 시간대 예약만 차단
  - 밤샘 대여 제한: 밤샘 시간대 예약만 차단
  - 종일 제한: 조기 + 밤샘 둘 다 선택시 자동으로 종일 제한
- **기간 설정**: 단일 날짜 또는 기간으로 설정 가능
- **예약 영향**: 예약 제한 항목은 자동으로 예약에 영향

## 데이터 구조

```typescript
interface ScheduleEvent {
  id: string;
  date: string;
  endDate?: string; // 기간 설정시 사용
  title: string;
  type: 'special' | 'early_open' | 'overnight' | 'early_close' | 'event' | 'reservation_block';
  description?: string;
  startTime?: string;
  endTime?: string;
  affectsReservation: boolean;
  blockType?: 'early' | 'overnight' | 'all_day'; // 예약 제한 타입
}
```

## 사용 시나리오

### 1. 밤샘 영업 설정
1. 캘린더에서 날짜 선택 또는 "새 일정 추가" 클릭
2. 일정 유형: "밤샘 영업" 선택
3. 종료 시간: 05:00 (다음날 새벽)
4. 설명: "주말 특별 밤샘 영업"
5. 저장

### 2. 예약 제한 설정
1. 캘린더에서 날짜 선택 또는 "새 일정 추가" 클릭
2. 일정 유형: "예약 제한" 선택
3. 기간 설정 체크 (필요시)
4. 제한 범위 선택:
   - ✓ 조기 대여 제한
   - ✓ 밤샘 대여 제한
   - → 자동으로 "종일 예약 제한" 표시
5. 설명: "시스템 점검으로 인한 예약 제한"
6. 저장

### 3. 조기 마감 설정
1. 캘린더에서 날짜 선택
2. 일정 유형: "조기 마감" 선택
3. 종료 시간: 18:00
4. 설명: "기기 정비로 인한 조기 마감"
5. 저장

## UI/UX 특징

### 캘린더 뷰
- 월별 캘린더에서 일정을 한눈에 확인
- 일정 유형별 색상 구분:
  - 특별 운영: 파란색
  - 조기 오픈: 노란색
  - 밤샘 영업: 보라색
  - 조기 마감: 주황색
  - 이벤트: 초록색
  - 예약 제한: 빨간색

### 예약 현황 표시

#### 캘린더 표시 방식
- **모바일 (작은 화면)**:
  - 조기 예약: 🟡 6 (노란색 점 + 총 개수)
  - 밤샘 예약: 🟣 6 (보라색 점 + 총 개수)
  - 공간 효율을 위해 시간대별 총 개수만 표시

- **데스크톱 (큰 화면)**:
  - 기종별로 상세하게 표시
  - 예: 🟡 [2][1][1] (마이마이 2대, 츄니즘 1대 등)
  - 각 기종별 색상으로 구분

#### 예약 상세 모달
날짜를 클릭하면 예약 상세 정보를 모달로 표시:

1. **시간대별 그룹화**
   - 조기 대여와 밤샘 대여를 구분하여 표시
   - 각 시간대별 헤더에 색상 점과 총 건수 뱃지

2. **기종별 카드 형식**
   ```
   ┌─────────────────────────────────┐
   │ [마이마이 DX]              2건  │
   │ 1번기 • 2인 플레이   07:00-12:00 │
   │ 2번기 • 1인 플레이   08:00-12:00 │
   └─────────────────────────────────┘
   ```
   - 기종명은 설정된 색상으로 뱃지 표시
   - 각 예약별로 기기 번호, 인원수, 시간 표시
   - 같은 기종의 여러 예약을 하나의 카드로 묶어 표시

3. **정보 우선순위**
   - 기기 번호: 어떤 기기를 대여하는지 명확히 표시
   - 인원수: 1인/2인 플레이 구분
   - 시간대: 대여 시작-종료 시간

4. **모바일 최적화**
   - 최대 높이 90vh로 제한
   - 스크롤 가능한 컨테이너
   - 터치 친화적인 여백과 크기

#### 색상 체계
- **시간대별 색상**:
  - 조기 대여: 노란색 (조기 오픈과 통일)
  - 밤샘 대여: 보라색 (밤샘 영업과 통일)
- **기종별 색상**:
  - 대여기기 관리에서 설정한 색상 사용
  - 9가지 기본 색상 팔레트 제공

### 일정 목록
- 이번 달 일정 요약 표시
- 날짜별 정렬
- 빠른 편집/삭제 기능

### 일정 추가/수정 폼
- 직관적인 입력 폼
- 일정 유형에 따라 필요한 입력 필드만 표시
- 기간 설정 옵션 (체크박스로 활성화)

## 비즈니스 로직

### 예약 시스템 연동
1. **예약 제한 적용**:
   - 예약 제한이 설정된 날짜는 해당 시간대 예약 불가
   - 조기 제한: 조기 시간대 예약 차단
   - 밤샘 제한: 밤샘 시간대 예약 차단
   - 종일 제한: 모든 시간대 예약 차단

2. **운영 시간 변경**:
   - 특별 운영 시간은 기본 운영 시간을 덮어씀
   - 조기 마감시 해당 시간 이후 예약 불가
   - 밤샘 영업시 새벽 시간대 예약 가능

## 안내 사항
- 예약 제한은 예약 제한 항목에서만 설정 가능
- 특별 운영, 조기 오픈, 밤샘 영업, 조기 마감은 운영 시간만 변경
- 이벤트는 정보 표시용으로 예약에 영향 없음

## 사용자 페이지 운영일정 표시

### 기본 영업시간
- **월~목, 일요일, 공휴일**: 12:00 - 22:00 (22시 이후 손님 없으면 마감)
- **금, 토, 공휴일 전날**: 11:00 - 05:00 (밤샘 영업, 익일 새벽 5시까지)
- **특이사항**: 금요일은 11시 오픈, 토요일은 11시 오픈, 일요일은 12시 오픈

### 캘린더 통합
- 관리자와 동일한 캘린더 UI/UX 사용
- 예약 현황을 시각적으로 표시
- 범례를 컴팩트하게 정리하여 데스크톱에서도 깔끔한 레이아웃

## 자동 영업일정 업데이트 기능

### 개요
예약이 승인될 때 자동으로 해당 날짜의 영업 일정을 업데이트하는 기능입니다.

### 동작 방식
1. **조기영업 자동 설정**
   - 조기대여 예약이 승인되면
   - 같은 날짜의 조기대여 예약 중 가장 빠른 시작 시간을 찾아
   - 자동으로 "조기영업" 일정 생성 또는 업데이트
   - 예: 07:00 조기대여 승인 → 07:00 조기영업 일정 자동 생성

2. **밤샘영업 자동 설정**
   - 밤샘대여 예약이 승인되면
   - 같은 날짜의 밤샘대여 예약 중 가장 늦은 종료 시간을 찾아
   - 자동으로 "밤샘영업" 일정 생성 또는 업데이트
   - 예: 05:00까지 밤샘대여 승인 → 05:00 밤샘영업 일정 자동 생성

### 특징
- **자동 생성 표시**: 자동으로 생성된 일정은 "(자동)" 표시
- **수동 수정 가능**: 자동 생성된 일정도 관리자가 수동으로 수정 가능
- **수동 우선**: 이미 수동으로 생성된 일정이 있으면 자동 생성하지 않음
- **실시간 업데이트**: 새로운 예약 승인 시 자동으로 최적 시간으로 재조정

### 데이터베이스 구조
```sql
-- schedule_events 테이블 추가 필드
is_auto_generated BOOLEAN DEFAULT FALSE,  -- 자동 생성 여부
source_type VARCHAR(50),  -- 'manual' | 'reservation_auto'
source_reference UUID  -- 자동 생성 시 참조 예약 ID
```

## 시스템 개선사항 (2025-07-14)

### 운영일정 데이터 독립성 확보
- **문제**: 사용자 계정 탈퇴 시 운영일정도 함께 삭제되는 문제
- **해결**: created_by 외래키 제약조건을 CASCADE에서 SET NULL로 변경
- **결과**: 운영일정은 사용자와 독립적으로 유지되며, 사용자 삭제 시 created_by만 NULL로 설정

### 관리자 일정 수정 UX 개선
- **변경 전**: 일정 클릭 → 상세보기 모달 → 수정 버튼 클릭 → 수정 모달
- **변경 후**: 일정 클릭 → 바로 수정 모달 표시
- **개선 효과**: 
  - 클릭 단계 감소로 작업 효율성 향상
  - 일반 사용자 화면과 일관된 UX 제공
  - 불필요한 상세보기 모달 제거

## 향후 개선사항
1. 반복 일정 설정 기능
2. 일정 템플릿 기능
3. 공휴일 자동 인식
4. 일정 변경 히스토리 관리
5. 고객 알림 기능 연동
6. 예약 통계 대시보드 연동
7. 자동 영업일정 최적화 알고리즘 개선