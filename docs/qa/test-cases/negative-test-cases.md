# 🚨 네거티브 테스트 케이스

## 📋 문서 개요

이 문서는 광주 게임플라자 예약 시스템의 **예외처리 상황**과 **네거티브 케이스**를 체계적으로 정리합니다.
정상적인 사용자 시나리오가 아닌, **오류 상황**, **비정상적인 입력**, **시스템 장애** 등의 상황에서 시스템이 어떻게 대응해야 하는지 검증합니다.

## 🎯 테스트 목표

- **시스템 안정성**: 예외 상황에서도 시스템이 크래시되지 않음
- **사용자 경험**: 오류 발생 시 명확한 안내 메시지 제공
- **데이터 무결성**: 오류 상황에서도 데이터 손실 방지
- **보안 강화**: 악의적인 입력이나 공격 시도 차단

---

## 🔐 1. 인증 시스템 네거티브 케이스

### 1.1 로그인 실패 시나리오

#### **TC-N001: 구글 OAuth 인증 실패**
```
전제조건: 로그인 페이지 접근
테스트 단계:
1. 구글 로그인 버튼 클릭
2. 구글 OAuth 팝업에서 "취소" 클릭
3. 네트워크 연결 차단 후 재시도
4. 잘못된 구글 계정으로 로그인 시도

예상 결과:
- 취소 시: "로그인이 취소되었습니다" 메시지
- 네트워크 오류: "네트워크 연결을 확인해주세요" 메시지
- 잘못된 계정: 적절한 오류 메시지 표시
- 로딩 상태가 무한 지속되지 않음
```

#### **TC-N002: 세션 만료 상황**
```
전제조건: 로그인된 상태
테스트 단계:
1. 개발자 도구에서 세션 토큰 삭제
2. 관리자 페이지 접근 시도
3. API 호출 시도
4. 페이지 새로고침

예상 결과:
- 자동으로 로그인 페이지로 리다이렉트
- "세션이 만료되었습니다" 안내 메시지
- 진행 중이던 작업 내용 보존 (가능한 경우)
```

### 1.2 회원가입 실패 시나리오

#### **TC-N003: 닉네임 검증 실패**
```
테스트 데이터:
- 금지어 포함: "관리자", "어드민", "욕설"
- 길이 초과: "매우긴닉네임12345678"
- 특수문자: "닉네임!@#"
- 공백: "   ", "닉 네 임"
- 스크립트: "<script>alert('xss')</script>"

예상 결과:
- 실시간으로 오류 메시지 표시
- 회원가입 버튼 비활성화
- 적절한 대안 제시 ("다른 닉네임을 사용해주세요")
```

#### **TC-N004: 모더레이션 API 장애**
```
전제조건: /api/moderation/check API 응답 지연/실패
테스트 단계:
1. 닉네임 입력 후 검증 요청
2. API 타임아웃 상황 시뮬레이션
3. 500 Internal Server Error 상황

예상 결과:
- 로딩 인디케이터 적절한 시간 후 타임아웃
- "닉네임 검증 중 오류가 발생했습니다" 메시지
- 사용자가 다시 시도할 수 있는 옵션 제공
```

---

## 📅 2. 예약 신청 시스템 네거티브 케이스

### 2.1 24시간 제한 룰 위반

#### **TC-N005: 작성 중 24시간 미만으로 변경**
```
테스트 단계:
1. 내일 예약 가능한 시간대 선택
2. 기기 선택 및 옵션 설정 (천천히 진행)
3. 시간이 지나 24시간 미만이 되도록 대기
4. 최종 예약 신청 버튼 클릭

예상 결과:
- "예약 가능 시간이 지났습니다" 메시지
- 처음부터 다시 시작하도록 안내
- 진행 중인 데이터는 저장하지 않음
```

#### **TC-N006: 서버-클라이언트 시간 동기화 오차**
```
테스트 단계:
1. 클라이언트 시간을 5분 뒤로 조작
2. 24시간 정확히 경계선 시간대 예약 시도
3. 서버 응답과 클라이언트 검증 결과 비교

예상 결과:
- 서버 시간 기준으로 최종 검증
- 클라이언트 시간 조작으로 우회 불가
- 시간 오차 발생 시 서버 시간 우선
```

### 2.2 동시 예약 충돌

#### **TC-N007: 여러 사용자 동시 예약**
```
테스트 단계:
1. 동일한 시간대/기기를 2명이 동시 선택
2. 거의 동시에 예약 신청 버튼 클릭
3. 데이터베이스 경합 상황 확인

예상 결과:
- 먼저 처리된 예약만 성공
- 늦은 사용자는 "이미 예약된 시간입니다" 메시지
- 데이터 중복 생성 방지
```

#### **TC-N008: 예약 중 기기 상태 변경**
```
테스트 단계:
1. 사용자가 기기 선택 후 예약 진행 중
2. 관리자가 해당 기기를 'maintenance' 상태로 변경
3. 사용자가 예약 완료 시도

예상 결과:
- "선택한 기기를 사용할 수 없습니다" 메시지
- 다른 사용 가능한 기기 목록 제공
- 진행 중인 설정 내용은 유지
```

### 2.3 입력 데이터 검증 실패

#### **TC-N009: 특별 요청사항 악성 입력**
```
테스트 데이터:
- HTML 태그: "<h1>제목</h1><script>alert('xss')</script>"
- 매우 긴 텍스트: 1000자 이상의 긴 문자열
- 특수문자: "!@#$%^&*()_+{}[]|\\:;\"'<>,.?/"
- 이모지: "😀😃😄😁😆😅😂🤣"

예상 결과:
- HTML 태그는 이스케이프되어 표시
- 길이 제한 적용 (예: 200자)
- 특수문자는 허용하되 스크립트 실행 방지
- 이모지는 정상 저장 및 표시
```

#### **TC-N010: 비정상적인 API 요청**
```
테스트 단계:
1. 존재하지 않는 기기 ID로 예약 시도
2. 음수 플레이어 수 전송
3. 잘못된 날짜 형식 전송 ("2025-13-45")
4. 권한 없는 기기 예약 시도

예상 결과:
- 400 Bad Request 응답
- 구체적인 오류 메시지 제공
- 클라이언트에서 적절한 오류 처리
- 악의적 요청은 로그에 기록
```

---

## 🎮 3. 기기 선택 UI 네거티브 케이스

### 3.1 터치 인터페이스 오류

#### **TC-N011: 빠른 연속 터치**
```
테스트 단계:
1. 기기 선택 화면에서 여러 기기를 빠르게 연속 터치
2. 선택 상태 변경 중 다른 기기 터치
3. 로딩 중인 상태에서 추가 터치

예상 결과:
- 중복 선택 방지
- 로딩 중에는 추가 터치 무시
- 시각적 피드백 일관성 유지
```

#### **TC-N012: 스크롤 중 의도치 않은 선택**
```
테스트 단계:
1. 기기 목록을 빠르게 스크롤
2. 스크롤 중 기기 영역에 터치 발생
3. 스크롤 제스처와 탭 제스처 구분

예상 결과:
- 스크롤 의도가 명확하면 선택되지 않음
- 터치 지속 시간으로 의도 구분
- 잘못 선택된 경우 쉽게 취소 가능
```

### 3.2 화면 크기/회전 변경

#### **TC-N013: 세로↔가로 회전 중 상태 유지**
```
테스트 단계:
1. 기기 선택 진행 중 화면 회전
2. 선택된 기기와 옵션 상태 확인
3. 레이아웃 재배치 확인

예상 결과:
- 선택 상태 유지
- 레이아웃 깨짐 없음
- 진행 중인 작업 계속 가능
```

#### **TC-N014: 키보드 팝업으로 화면 크기 변경**
```
테스트 단계:
1. 특별 요청사항 입력 필드 포커스
2. 가상 키보드 팝업으로 화면 크기 변경
3. 키보드 닫기 후 원래 크기 복원

예상 결과:
- 입력 필드가 키보드에 가려지지 않음
- 스크롤 가능한 영역 자동 조정
- 키보드 닫기 후 정상 레이아웃 복원
```

---

## 💳 4. 체크인 & 결제 시스템 네거티브 케이스

### 4.1 결제 프로세스 오류

#### **TC-N015: 계좌이체 프로세스 실패**
```
테스트 단계:
1. 계좌번호 복사 기능 실패 (클립보드 접근 거부)
2. 입금자명에 특수문자 포함
3. 결제 확인 중 관리자 로그아웃

예상 결과:
- 복사 실패 시 계좌번호 텍스트 선택 가능하도록 안내
- 입금자명 특수문자 필터링 또는 안내
- 관리자 교체 시에도 결제 확인 가능
```

#### **TC-N016: 시간/금액 조정 오류**
```
테스트 단계:
1. 종료 시간을 시작 시간보다 이전으로 설정
2. 음수 금액 입력
3. 조정 사유 없이 저장 시도

예상 결과:
- 시간 유효성 검증 및 오류 메시지
- 음수 금액 입력 방지
- 조정 사유 필수 입력 검증
```

### 4.2 상태 변경 오류

#### **TC-N017: 동시 상태 변경 충돌**
```
테스트 단계:
1. 두 관리자가 동시에 같은 예약 처리
2. 체크인 → 결제완료 상태 변경 중 다른 관리자가 노쇼 처리
3. 상태 변경 중 시스템 오류 발생

예상 결과:
- 먼저 처리된 상태 변경만 적용
- 나중 작업은 "이미 처리된 예약입니다" 메시지
- 상태 변경 실패 시 이전 상태로 롤백
```

---

## 📱 5. PWA 기능 네거티브 케이스

### 5.1 오프라인 상태 처리

#### **TC-N018: 네트워크 연결 끊김**
```
테스트 단계:
1. 예약 신청 진행 중 네트워크 차단
2. 오프라인 상태에서 예약 시도
3. 온라인 복구 시 동기화 확인

예상 결과:
- "인터넷 연결을 확인해주세요" 메시지
- 진행 중인 작업 임시 저장
- 온라인 복구 시 자동 재시도 또는 수동 재시도 옵션
```

#### **TC-N019: 캐시된 데이터와 실제 데이터 불일치**
```
테스트 단계:
1. 오프라인 상태에서 캐시된 기기 현황 확인
2. 온라인 상태에서 실제 기기 현황과 비교
3. 불일치 데이터로 예약 시도

예상 결과:
- 온라인 복구 시 실시간 데이터로 자동 업데이트
- 불일치 발견 시 사용자에게 알림
- 캐시된 데이터 기반 예약은 서버에서 재검증
```

### 5.2 푸시 알림 실패

#### **TC-N020: 알림 권한 거부**
```
테스트 단계:
1. 브라우저에서 알림 권한 거부
2. 예약 승인/거절 상황 발생
3. 알림 재요청 프로세스

예상 결과:
- 권한 거부 시 대안 알림 방법 안내
- 이메일 알림 등 다른 채널 활용
- 알림 권한 재요청 가이드 제공
```

---

## 🔒 6. 보안 관련 네거티브 케이스

### 6.1 권한 우회 시도

#### **TC-N021: 일반 사용자의 관리자 접근**
```
테스트 단계:
1. 일반 사용자로 로그인 후 /admin URL 직접 접근
2. 개발자 도구에서 JWT 토큰 조작
3. API 엔드포인트 직접 호출

예상 결과:
- 즉시 홈페이지로 리다이렉트
- "접근 권한이 없습니다" 메시지
- 보안 로그에 시도 기록
```

#### **TC-N022: 세션 하이재킹 시뮬레이션**
```
테스트 단계:
1. 정상 사용자의 세션 토큰 복사
2. 다른 브라우저/기기에서 토큰 사용
3. 동시 세션 검증

예상 결과:
- 중복 세션 감지 및 차단
- 기존 세션 무효화 또는 보안 경고
- 사용자에게 보안 알림 발송
```

### 6.2 입력 데이터 조작

#### **TC-N023: SQL Injection 시도**
```
테스트 데이터:
- "'; DROP TABLE users; --"
- "1' OR '1'='1"
- "admin'/**/AND/**/1=1#"

예상 결과:
- 모든 입력 데이터 이스케이프 처리
- 파라미터화된 쿼리 사용으로 차단
- 악의적 시도 로그 기록
```

#### **TC-N024: XSS 스크립트 삽입**
```
테스트 데이터:
- "<script>alert('XSS')</script>"
- "javascript:alert('XSS')"
- "<img src=x onerror=alert('XSS')>"

예상 결과:
- HTML 엔티티 인코딩으로 무력화
- CSP(Content Security Policy) 헤더로 차단
- 스크립트 실행 방지
```

---

## 🌐 7. 브라우저 호환성 네거티브 케이스

### 7.1 구형 브라우저 지원

#### **TC-N025: iOS Safari 구 버전**
```
테스트 환경:
- iOS Safari 14 이하
- 일부 ES6+ 기능 미지원
- PWA 기능 제한

예상 결과:
- 폴리필로 기본 기능 동작
- 지원되지 않는 기능은 대안 제공
- "브라우저 업데이트 권장" 안내
```

#### **TC-N026: JavaScript 비활성화**
```
테스트 단계:
1. 브라우저에서 JavaScript 비활성화
2. 웹사이트 접근 시도
3. 기본 기능 사용 시도

예상 결과:
- "JavaScript를 활성화해주세요" 안내 페이지
- 기본적인 HTML 정보는 표시
- 핵심 기능 사용 불가 안내
```

### 7.2 접근성 문제

#### **TC-N027: 스크린 리더 호환성**
```
테스트 단계:
1. NVDA/JAWS 스크린 리더 사용
2. 키보드만으로 전체 사이트 탐색
3. 중요 정보 음성 안내 확인

예상 결과:
- 모든 UI 요소에 적절한 라벨 제공
- 키보드 네비게이션 가능
- 중요한 상태 변경 음성 안내
```

---

## 📊 8. 성능 스트레스 네거티브 케이스

### 8.1 동시 접속자 부하

#### **TC-N028: 100명 동시 예약 신청**
```
테스트 단계:
1. 부하 테스트 도구로 동시 접속자 시뮬레이션
2. 같은 시간대에 대량 예약 시도
3. 데이터베이스 락 경합 상황 확인

예상 결과:
- 응답 시간 5초 이내 유지
- 데이터 중복/손실 방지
- 서버 크래시 없음
```

#### **TC-N029: 메모리 누수 검사**
```
테스트 단계:
1. 브라우저에서 24시간 지속적으로 사이트 사용
2. SPA 라우팅 반복 (100회 이상)
3. 실시간 업데이트 장시간 수신

예상 결과:
- 메모리 사용량 일정 수준 유지
- 가비지 컬렉션 정상 동작
- 브라우저 응답성 유지
```

---

## 🎯 테스트 실행 가이드

### 테스트 우선순위

**🔴 High Priority (매 릴리스 필수)**
- 인증 시스템 실패 케이스
- 예약 시스템 충돌 케이스
- 결제 시스템 오류 케이스
- 보안 취약점 테스트

**🟡 Medium Priority (주요 릴리스)**
- UI/UX 오류 케이스
- PWA 기능 실패 케이스
- 브라우저 호환성 케이스

**🟢 Low Priority (분기별)**
- 성능 스트레스 테스트
- 접근성 문제 케이스
- 메모리 누수 테스트

### 테스트 환경 설정

```bash
# 테스트 환경 변수 설정
export NODE_ENV=test
export NEXT_PUBLIC_SUPABASE_URL=<테스트_DB_URL>

# 네거티브 테스트 실행
npm run test:negative

# 특정 카테고리 테스트
npm run test -- --grep "인증 시스템"
```

### 결과 보고서 양식

각 테스트 케이스 실행 후 다음 정보를 기록:

- **TC-N001**: ✅ 통과 / ❌ 실패
- **실패 시 세부사항**: 오류 메시지, 스크린샷, 재현 단계
- **개선 사항**: 발견된 문제점과 해결 방안
- **영향도**: Critical / High / Medium / Low

---

## 📞 문의 및 피드백

네거티브 테스트 케이스 관련 문의사항이나 추가 케이스 제안은 다음 채널로 연락해주세요:

- **QA 팀 슬랙**: #qa-negative-tests
- **이슈 등록**: GitHub Issues with label "negative-test"
- **문서 개선**: PR 제출

**⚠️ 중요**: 네거티브 테스트에서 발견한 보안 취약점은 공개 채널이 아닌 직접 보안 담당자에게 보고해주세요.

---

*마지막 업데이트: 2025-07-25*
*작성자: QA Team*
*리뷰어: Security Team, Development Team*