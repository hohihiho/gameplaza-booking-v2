# 🔗 통합 테스트 케이스

> **목표**: 시스템 컴포넌트 간의 상호작용과 전체 플로우가 정상적으로 동작하는지 검증

## 📋 문서 개요

이 문서는 게임플라자 예약 시스템의 **통합 테스트 케이스**를 정의합니다.
개별 모듈이 아닌 전체 시스템의 통합적인 동작을 검증하며, 실제 사용자 시나리오를 기반으로 합니다.

## 🎯 통합 테스트 영역

1. **End-to-End 사용자 플로우**
2. **시스템 간 데이터 동기화**
3. **실시간 기능 통합**
4. **외부 서비스 연동**
5. **크로스 플랫폼 호환성**

---

## 🚀 1. End-to-End 사용자 플로우

### 1.1 완전한 예약 라이프사이클

#### **TC-I001: 회원가입부터 예약 완료까지**
```gherkin
Feature: 신규 사용자 예약 플로우

Scenario: 첫 방문 사용자가 예약을 완료한다
  Given 게임플라자 웹사이트에 처음 방문
  When 구글 OAuth로 회원가입
  And 닉네임 "게임매니아" 설정
  And AI 모더레이션 통과
  And 마케팅 동의 선택
  Then 회원가입 완료 및 홈으로 이동

  When 예약하기 버튼 클릭
  And 내일 날짜 선택
  And "마이마이" 기기 선택
  And 밤샘대여 22:00-29:00 선택
  And 프리플레이 모드 선택
  And 2인 플레이 옵션 추가
  And 특별 요청사항 "처음이라 도움 필요해요" 입력
  Then 예약 신청 완료

  When 관리자가 예약 승인
  Then 푸시 알림 수신
  And 예약 상태 "승인됨" 변경
  And 카카오톡 알림 발송

검증 항목:
- ✅ 모든 단계 정상 진행
- ✅ 데이터 일관성 유지
- ✅ 알림 정상 발송
- ✅ 상태 실시간 동기화
```

#### **TC-I002: 체크인부터 체크아웃까지**
```gherkin
Feature: 체크인/체크아웃 전체 플로우

Scenario: 예약자가 방문하여 이용을 완료한다
  Given 승인된 예약 존재
  When 예약 시간 30분 전 도착
  And 관리자가 체크인 처리
  And 계좌이체 결제 선택
  And 입금 확인 후 결제완료 처리
  Then 기기 사용 시작

  When 이용 시간 연장 요청
  And 관리자가 종료시간 2시간 연장
  And 추가 금액 20,000원 조정
  Then 시간/금액 조정 완료

  When 이용 종료 시간 도달
  And 관리자가 체크아웃 처리
  Then 예약 상태 "완료"
  And 이용 통계 업데이트
  And 매출 데이터 반영

검증 항목:
- ✅ 상태 전이 정확성
- ✅ 금액 계산 정확성
- ✅ 시간 조정 반영
- ✅ 통계 실시간 업데이트
```

### 1.2 예외 상황 처리 플로우

#### **TC-I003: 노쇼 처리 전체 플로우**
```gherkin
Feature: 노쇼 처리 시나리오

Scenario: 예약자가 나타나지 않아 노쇼 처리된다
  Given 오늘 14:00 승인된 예약
  When 14:30까지 미도착
  And 관리자가 노쇼 처리
  Then 예약 상태 "노쇼"
  And 기기 상태 "available" 복구
  And 사용자 노쇼 이력 기록
  And 향후 예약 제한 정책 적용

검증 항목:
- ✅ 노쇼 이력 추적
- ✅ 기기 즉시 해제
- ✅ 통계 정확히 반영
- ✅ 제한 정책 동작
```

#### **TC-I004: 예약 충돌 해결 플로우**
```gherkin
Feature: 동시 예약 충돌 해결

Scenario: 여러 사용자가 동시에 같은 시간대를 예약한다
  Given 인기 시간대 마지막 1자리
  When 사용자A가 예약 진행 중
  And 사용자B가 동시에 같은 시간대 선택
  And 사용자A가 먼저 예약 완료
  Then 사용자B는 "이미 예약된 시간" 메시지
  And 실시간으로 예약 현황 업데이트
  And 대체 시간대 추천

검증 항목:
- ✅ 동시성 제어 정상
- ✅ 실시간 상태 반영
- ✅ 사용자 경험 최적화
- ✅ 데이터 일관성
```

---

## 🔄 2. 시스템 간 데이터 동기화

### 2.1 실시간 상태 동기화

#### **TC-I005: 다중 관리자 동시 작업**
```typescript
테스트 시나리오:
1. 관리자A: 예약 승인 처리
2. 관리자B: 같은 예약 거절 시도
3. 관리자C: 대시보드에서 실시간 확인

검증 항목:
- ✅ 첫 번째 작업만 성공
- ✅ 모든 화면 즉시 동기화
- ✅ 충돌 메시지 명확
- ✅ 작업 이력 추적

기술 스택:
- Supabase Realtime
- WebSocket 연결
- Optimistic UI 업데이트
```

#### **TC-I006: 모바일-웹 크로스 동기화**
```typescript
테스트 시나리오:
1. 모바일: 예약 생성
2. 웹: 실시간 확인
3. 태블릿: 상태 변경
4. 모든 기기: 동기화 확인

검증 항목:
- ✅ 3초 이내 동기화
- ✅ 오프라인 후 동기화
- ✅ 충돌 자동 해결
- ✅ 데이터 손실 없음
```

### 2.2 통계 데이터 집계

#### **TC-I007: 실시간 대시보드 업데이트**
```typescript
테스트 시나리오:
1. 예약 생성/수정/삭제
2. 체크인/결제 처리
3. 매출 데이터 변경
4. 대시보드 자동 업데이트

검증 항목:
- ✅ 30초마다 자동 갱신
- ✅ 수동 새로고침 가능
- ✅ 데이터 정확성 100%
- ✅ 그래프 실시간 변경

집계 항목:
- 오늘 매출/어제 대비
- 예약 현황 (상태별)
- 기기 가동률
- 시간대별 분포
```

#### **TC-I008: 06시 영업일 리셋 통합**
```typescript
테스트 시나리오:
1. 05:59 - 전일 데이터
2. 06:00 - 신규 영업일
3. 통계 리셋 및 이전
4. 예약 번호 초기화

검증 항목:
- ✅ 정확히 06:00 전환
- ✅ 데이터 누락 없음
- ✅ 이전 데이터 보존
- ✅ 연속성 유지

영향 범위:
- 일일 매출 집계
- 예약 번호 시퀀스
- 통계 그래프
- 리포트 생성
```

---

## 📡 3. 실시간 기능 통합

### 3.1 WebSocket 통합

#### **TC-I009: 실시간 예약 현황판**
```typescript
테스트 시나리오:
1. 10명 동시 접속
2. 각자 다른 작업 수행
3. 모든 화면 실시간 반영
4. 네트워크 불안정 상황

검증 항목:
- ✅ 브로드캐스트 정상
- ✅ 메시지 순서 보장
- ✅ 재연결 자동 처리
- ✅ 상태 복구 완벽

성능 지표:
- 지연시간 < 1초
- 메시지 손실 0%
- 동시 연결 1000+
- 메모리 안정성
```

#### **TC-I010: 푸시 알림 통합**
```typescript
테스트 시나리오:
1. 예약 승인 → 푸시 발송
2. 예약 시간 임박 → 리마인더
3. 상태 변경 → 실시간 알림
4. 다중 기기 동시 수신

검증 항목:
- ✅ FCM 토큰 관리
- ✅ 알림 권한 처리
- ✅ 백그라운드 수신
- ✅ 딥링크 동작

알림 종류:
- 예약 승인/거절
- 체크인 알림
- 시간 임박 경고
- 프로모션 안내
```

### 3.2 PWA 기능 통합

#### **TC-I011: 오프라인 모드 전환**
```typescript
테스트 시나리오:
1. 온라인 상태에서 데이터 캐싱
2. 네트워크 차단
3. 오프라인 모드 활성화
4. 온라인 복구 시 동기화

검증 항목:
- ✅ Service Worker 동작
- ✅ 캐시 전략 적용
- ✅ 오프라인 UI 표시
- ✅ 동기화 완벽

캐시 항목:
- 정적 자원 (JS/CSS)
- 기기 목록
- 사용자 정보
- 최근 예약
```

#### **TC-I012: 홈 화면 설치 플로우**
```typescript
테스트 시나리오:
1. PWA 설치 프롬프트
2. 홈 화면 추가
3. 독립 실행 모드
4. 네이티브 같은 경험

검증 항목:
- ✅ 설치 배너 표시
- ✅ 아이콘/스플래시
- ✅ 전체화면 모드
- ✅ 제스처 네비게이션

플랫폼별:
- iOS Safari
- Android Chrome
- Samsung Internet
- Desktop PWA
```

---

## 🌐 4. 외부 서비스 연동

### 4.1 인증 서비스 통합

#### **TC-I013: 구글 OAuth 전체 플로우**
```typescript
테스트 시나리오:
1. 구글 로그인 시작
2. 권한 동의 화면
3. 콜백 처리
4. 세션 생성

검증 항목:
- ✅ OAuth 2.0 플로우
- ✅ 토큰 안전 저장
- ✅ 프로필 정보 동기화
- ✅ 에러 처리

예외 상황:
- 권한 거부
- 네트워크 오류
- 토큰 만료
- 계정 정지
```

#### **TC-I014: AI 모더레이션 API 통합**
```typescript
테스트 시나리오:
1. 닉네임 입력
2. AI API 호출
3. 결과 처리
4. 사용자 피드백

검증 항목:
- ✅ API 응답 시간
- ✅ 오류 시 폴백
- ✅ 결과 정확성
- ✅ 재시도 로직

모더레이션 항목:
- 비속어 필터
- 스팸 감지
- 부적절 내용
- 다국어 지원
```

### 4.2 결제 시스템 통합

#### **TC-I015: 계좌이체 확인 플로우**
```typescript
테스트 시나리오:
1. 계좌정보 표시
2. 복사 기능 제공
3. 입금 확인 대기
4. 수동 확인 처리

검증 항목:
- ✅ 계좌 정보 정확성
- ✅ 클립보드 복사
- ✅ 입금자명 매칭
- ✅ 확인 알림 발송

통합 요소:
- 은행 API (향후)
- 입금 알림
- 자동 매칭
- 환불 처리
```

---

## 📱 5. 크로스 플랫폼 호환성

### 5.1 브라우저 호환성

#### **TC-I016: 멀티 브라우저 테스트**
```typescript
테스트 브라우저:
- Chrome 90+ (Desktop/Mobile)
- Safari 14+ (macOS/iOS)
- Firefox 88+
- Samsung Internet 14+
- Edge 90+

검증 항목:
- ✅ 레이아웃 일관성
- ✅ 기능 정상 동작
- ✅ 성능 차이 최소화
- ✅ 폴리필 적용

주요 기능:
- Date/Time 처리
- WebSocket
- Service Worker
- Push API
```

#### **TC-I017: 반응형 디자인 통합**
```typescript
테스트 해상도:
- Mobile: 375x667 (iPhone SE)
- Tablet: 768x1024 (iPad)
- Desktop: 1920x1080
- 4K: 3840x2160

검증 항목:
- ✅ 브레이크포인트
- ✅ 터치 인터페이스
- ✅ 폰트 가독성
- ✅ 이미지 최적화

디바이스별:
- iPhone 12/13/14
- Galaxy S21/S22
- iPad Pro
- Desktop Chrome
```

### 5.2 성능 통합 테스트

#### **TC-I018: 3G 네트워크 시뮬레이션**
```typescript
테스트 조건:
- Download: 1.6 Mbps
- Upload: 750 Kbps
- Latency: 300ms
- Packet Loss: 2%

검증 항목:
- ✅ 초기 로딩 < 5초
- ✅ 인터랙션 < 3초
- ✅ 이미지 레이지 로드
- ✅ 오프라인 폴백

최적화 기법:
- 번들 스플리팅
- 이미지 압축
- CDN 활용
- 캐시 전략
```

#### **TC-I019: 메모리 사용량 통합**
```typescript
테스트 시나리오:
1. 앱 시작 시 메모리
2. 30분 사용 후
3. 백그라운드 전환
4. 장시간 유휴 상태

검증 항목:
- ✅ 초기 < 50MB
- ✅ 피크 < 200MB
- ✅ 메모리 누수 없음
- ✅ GC 정상 동작

모니터링:
- Chrome DevTools
- Performance Monitor
- Memory Profiler
- Heap Snapshot
```

---

## 🔧 6. 시스템 통합 시나리오

### 6.1 대규모 이벤트 시뮬레이션

#### **TC-I020: 오픈 이벤트 대응**
```typescript
테스트 시나리오:
1. 100명 동시 접속
2. 50개 예약 동시 생성
3. 실시간 업데이트
4. 시스템 안정성

검증 항목:
- ✅ 응답 시간 유지
- ✅ 에러율 < 1%
- ✅ 데이터 일관성
- ✅ 자동 스케일링

부하 분산:
- CDN 캐싱
- DB 커넥션 풀
- 큐잉 시스템
- Rate Limiting
```

### 6.2 장애 복구 시나리오

#### **TC-I021: 시스템 장애 복구**
```typescript
테스트 시나리오:
1. DB 일시 중단
2. 서버 재시작
3. 네트워크 단절
4. 자동 복구

검증 항목:
- ✅ 자동 재연결
- ✅ 데이터 복구
- ✅ 상태 일관성
- ✅ 사용자 알림

복구 전략:
- Circuit Breaker
- Retry Logic
- Fallback UI
- 복구 알림
```

---

## 📊 통합 테스트 실행 가이드

### 테스트 환경 구성

```bash
# 통합 테스트 환경 설정
export TEST_ENV=integration
export SUPABASE_URL=<TEST_URL>
export NEXT_PUBLIC_ENV=test

# 테스트 데이터 시드
npm run seed:test

# 통합 테스트 실행
npm run test:integration
```

### 테스트 우선순위

1. **Critical Path** (일일 실행)
   - 예약 전체 플로우
   - 결제 프로세스
   - 실시간 동기화

2. **Extended Tests** (주간 실행)
   - 크로스 플랫폼
   - 성능 테스트
   - 장애 시나리오

3. **Full Suite** (릴리스 전)
   - 모든 통합 테스트
   - 부하 테스트
   - 보안 스캔

### 결과 리포팅

```markdown
## 통합 테스트 결과

날짜: YYYY-MM-DD
환경: Staging
실행자: QA Team

### 요약
- 전체: 35개
- 성공: 33개
- 실패: 2개
- 성공률: 94.3%

### 실패 케이스
1. TC-I010: 푸시 알림 iOS 실패
   - 원인: iOS 17.2 권한 변경
   - 조치: 권한 로직 수정

2. TC-I018: 3G 성능 목표 미달
   - 원인: 번들 크기 증가
   - 조치: 코드 스플리팅
```

---

⚠️ **중요**: 통합 테스트는 실제 사용자 경험을 검증하는 핵심 단계입니다.

*마지막 업데이트: 2025-07-25*
*작성: QA Team*
*검토: Development Team*