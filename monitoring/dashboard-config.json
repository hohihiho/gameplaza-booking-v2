{
  "version": "1.0.0",
  "name": "게임플라자 v2 API 모니터링 대시보드",
  "refreshInterval": 30,
  "timeRange": {
    "from": "now-1h",
    "to": "now"
  },
  "panels": [
    {
      "id": "api-health",
      "title": "API 헬스 상태",
      "type": "stat",
      "gridPos": { "x": 0, "y": 0, "w": 6, "h": 4 },
      "targets": [
        {
          "metric": "api.health.status",
          "aggregation": "last"
        }
      ],
      "thresholds": {
        "ok": { "color": "green", "value": 1 },
        "warning": { "color": "yellow", "value": 0.9 },
        "critical": { "color": "red", "value": 0.8 }
      }
    },
    {
      "id": "response-time",
      "title": "응답 시간 (p95)",
      "type": "graph",
      "gridPos": { "x": 6, "y": 0, "w": 12, "h": 8 },
      "targets": [
        {
          "metric": "api.response_time.p95",
          "legend": "p95 응답 시간"
        },
        {
          "metric": "api.response_time.p99",
          "legend": "p99 응답 시간"
        }
      ],
      "yAxis": {
        "label": "시간 (ms)",
        "min": 0,
        "max": 500
      },
      "alert": {
        "conditions": [
          {
            "evaluator": {
              "type": "gt",
              "params": [200]
            },
            "operator": {
              "type": "and"
            },
            "query": {
              "model": "api.response_time.p95",
              "params": ["5m", "now"]
            },
            "reducer": {
              "type": "avg"
            },
            "type": "query"
          }
        ],
        "frequency": "60s",
        "handler": 1,
        "name": "응답 시간 초과",
        "noDataState": "no_data",
        "notifications": ["slack", "pagerduty"]
      }
    },
    {
      "id": "error-rate",
      "title": "에러율",
      "type": "graph",
      "gridPos": { "x": 0, "y": 4, "w": 12, "h": 8 },
      "targets": [
        {
          "metric": "api.errors.rate",
          "legend": "전체 에러율 (%)"
        },
        {
          "metric": "api.errors.5xx.rate",
          "legend": "5xx 에러율 (%)"
        },
        {
          "metric": "api.errors.4xx.rate",
          "legend": "4xx 에러율 (%)"
        }
      ],
      "yAxis": {
        "label": "에러율 (%)",
        "min": 0,
        "max": 10
      },
      "alert": {
        "conditions": [
          {
            "evaluator": {
              "type": "gt",
              "params": [1]
            },
            "query": {
              "model": "api.errors.rate",
              "params": ["5m", "now"]
            },
            "reducer": {
              "type": "avg"
            }
          }
        ],
        "frequency": "30s",
        "name": "높은 에러율 감지"
      }
    },
    {
      "id": "throughput",
      "title": "처리량",
      "type": "graph",
      "gridPos": { "x": 12, "y": 4, "w": 6, "h": 8 },
      "targets": [
        {
          "metric": "api.requests.rate",
          "legend": "요청/초"
        }
      ],
      "yAxis": {
        "label": "요청/초",
        "min": 0
      }
    },
    {
      "id": "canary-metrics",
      "title": "Canary 배포 지표",
      "type": "table",
      "gridPos": { "x": 0, "y": 12, "w": 12, "h": 6 },
      "targets": [
        {
          "metric": "deployment.canary.percentage",
          "alias": "트래픽 비율 (%)"
        },
        {
          "metric": "deployment.canary.error_rate",
          "alias": "Canary 에러율"
        },
        {
          "metric": "deployment.canary.response_time",
          "alias": "Canary 응답 시간"
        },
        {
          "metric": "deployment.stable.error_rate",
          "alias": "Stable 에러율"
        },
        {
          "metric": "deployment.stable.response_time",
          "alias": "Stable 응답 시간"
        }
      ]
    },
    {
      "id": "database-connections",
      "title": "데이터베이스 연결",
      "type": "stat",
      "gridPos": { "x": 12, "y": 12, "w": 6, "h": 6 },
      "targets": [
        {
          "metric": "database.connections.active",
          "aggregation": "last"
        },
        {
          "metric": "database.connections.idle",
          "aggregation": "last"
        }
      ],
      "thresholds": {
        "ok": { "color": "green", "value": 0 },
        "warning": { "color": "yellow", "value": 80 },
        "critical": { "color": "red", "value": 95 }
      }
    },
    {
      "id": "cache-hit-rate",
      "title": "캐시 적중률",
      "type": "gauge",
      "gridPos": { "x": 0, "y": 18, "w": 6, "h": 6 },
      "targets": [
        {
          "metric": "cache.hit_rate",
          "aggregation": "avg"
        }
      ],
      "gauge": {
        "maxValue": 100,
        "minValue": 0,
        "thresholdLabels": true,
        "thresholdMarkers": true
      },
      "thresholds": [
        { "color": "red", "value": 0 },
        { "color": "yellow", "value": 70 },
        { "color": "green", "value": 90 }
      ]
    },
    {
      "id": "user-sessions",
      "title": "활성 사용자 세션",
      "type": "stat",
      "gridPos": { "x": 6, "y": 18, "w": 6, "h": 6 },
      "targets": [
        {
          "metric": "users.sessions.active",
          "aggregation": "sum"
        }
      ]
    },
    {
      "id": "api-endpoints",
      "title": "엔드포인트별 성능",
      "type": "table",
      "gridPos": { "x": 12, "y": 18, "w": 6, "h": 6 },
      "targets": [
        {
          "query": "SELECT endpoint, count, avg_response_time, error_rate FROM api_metrics WHERE version='v2' ORDER BY count DESC LIMIT 10"
        }
      ],
      "columns": [
        { "text": "엔드포인트", "value": "endpoint" },
        { "text": "호출 수", "value": "count" },
        { "text": "평균 응답 시간", "value": "avg_response_time" },
        { "text": "에러율", "value": "error_rate" }
      ]
    }
  ],
  "notifications": {
    "slack": {
      "url": "${SLACK_WEBHOOK_URL}",
      "channel": "#gameplaza-alerts",
      "mention": "@devops"
    },
    "pagerduty": {
      "integrationKey": "${PAGERDUTY_KEY}",
      "severity": "warning"
    }
  },
  "variables": {
    "environment": {
      "type": "custom",
      "options": ["production", "staging", "canary"],
      "current": "production"
    },
    "api_version": {
      "type": "custom",
      "options": ["v1", "v2"],
      "current": "v2"
    }
  }
}