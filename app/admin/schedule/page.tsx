// ìš´ì˜ ì¼ì • ê´€ë¦¬ í˜ì´ì§€
// ë¹„ì „ê³µì ì„¤ëª…: ê´€ë¦¬ìê°€ íœ´ë¬´ì¼, íŠ¹ë³„ ìš´ì˜ ì‹œê°„ ë“±ì„ ê´€ë¦¬í•˜ëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤
'use client';

import React, { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { 
  Calendar,
  // CalendarDays,
  Plus,
  // Edit,
  Trash2,
  // Save,
  // X,
  ChevronLeft,
  ChevronRight,
  AlertCircle,
  Clock,
  // Info,
  Sun,
  Moon,
  Coffee,
  XCircle,
  Loader2,
  X,
  CalendarPlus,
  RefreshCw
} from 'lucide-react';

type ScheduleEvent = {
  id: string;
  date: string;
  endDate?: string; // ê¸°ê°„ ì„¤ì •ì‹œ ì‚¬ìš©
  title: string;
  type: 'special' | 'early_open' | 'overnight' | 'early_close' | 'event' | 'reservation_block';
  description?: string;
  startTime?: string;
  endTime?: string;
  isRecurring?: boolean;
  recurringType?: 'weekly' | 'monthly';
  affectsReservation: boolean;
  blockType?: 'early' | 'overnight' | 'all_day'; // ì˜ˆì•½ ì œí•œ íƒ€ì…
  isAutoGenerated?: boolean;
  sourceType?: 'manual' | 'reservation_auto';
};

const eventTypeConfig = {
  early_open: {
    label: 'ì¡°ê¸° ì˜ì—…',
    icon: Sun,
    color: 'text-yellow-600 bg-yellow-100 dark:bg-yellow-900/20',
    borderColor: 'border-yellow-200 dark:border-yellow-800'
  },
  overnight: {
    label: 'ë°¤ìƒ˜ ì˜ì—…',
    icon: Moon,
    color: 'text-purple-600 bg-purple-100 dark:bg-purple-900/20',
    borderColor: 'border-purple-200 dark:border-purple-800'
  },
  early_close: {
    label: 'ì¡°ê¸° ë§ˆê°',
    icon: Coffee,
    color: 'text-orange-600 bg-orange-100 dark:bg-orange-900/20',
    borderColor: 'border-orange-200 dark:border-orange-800'
  },
  reservation_block: {
    label: 'ì˜ˆì•½ ì œí•œ',
    icon: XCircle,
    color: 'text-red-600 bg-red-100 dark:bg-red-900/20',
    borderColor: 'border-red-200 dark:border-red-800'
  },
  special: {
    label: 'íŠ¹ë³„ ìš´ì˜',
    icon: Clock,
    color: 'text-blue-600 bg-blue-100 dark:bg-blue-900/20',
    borderColor: 'border-blue-200 dark:border-blue-800'
  },
  event: {
    label: 'ì´ë²¤íŠ¸',
    icon: Calendar,
    color: 'text-green-600 bg-green-100 dark:bg-green-900/20',
    borderColor: 'border-green-200 dark:border-green-800'
  }
};

interface Holiday {
  id?: string;
  name: string;
  date: string;
  type: 'official' | 'temporary' | 'substitute';
  is_red_day: boolean;
}

export default function ScheduleManagementPage() {
  const [selectedMonth, setSelectedMonth] = useState(new Date());
  const [events, setEvents] = useState<ScheduleEvent[]>([]);
  const [holidays, setHolidays] = useState<Holiday[]>([]);
  const [lastSyncTime, setLastSyncTime] = useState<Date | null>(null);
  const [isAddingEvent, setIsAddingEvent] = useState(false);
  const [editingEvent, setEditingEvent] = useState<ScheduleEvent | null>(null);
  const [selectedDate, setSelectedDate] = useState<string | null>(null);
  const [isLoading, setIsLoading] = useState(false);
  const [showDateEventsModal, setShowDateEventsModal] = useState(false);
  const [isGeneratingWeekend, setIsGeneratingWeekend] = useState(false);
  const [isSyncingHolidays, setIsSyncingHolidays] = useState(false);
  const [isSyncingReservations, setIsSyncingReservations] = useState(false);

  // 24ì‹œê°„ í‘œì‹œ í˜•ì‹ ë³€í™˜ í•¨ìˆ˜
  const formatTime24Hour = (time: string) => {
    if (!time) return '';
    const [hour, minute] = time.split(':');
    const hourNum = parseInt(hour || '0');
    
    // 0~5ì‹œë¥¼ 24~29ì‹œë¡œ ë³€í™˜
    if (hourNum >= 0 && hourNum <= 5) {
      return `${hourNum + 24}:${minute}`;
    }
    return `${hour}:${minute}`;
  };

  // ê³µíœ´ì¼ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
  const loadHolidays = async () => {
    try {
      const year = selectedMonth.getFullYear();
      const month = selectedMonth.getMonth() + 1;
      
      const response = await fetch(`/api/admin/holidays?year=${year}&month=${month}`, {
        credentials: 'include'
      });
      
      if (response.ok) {
        const data = await response.json();
        setHolidays(data.holidays || []);
        if (data.lastSyncTime) {
          setLastSyncTime(new Date(data.lastSyncTime));
        }
      }
    } catch (error) {
      console.error('ê³µíœ´ì¼ ë¡œë“œ ì‹¤íŒ¨:', error);
    }
  };

  // ê³µíœ´ì¼ ë™ê¸°í™”
  const syncHolidays = async () => {
    try {
      setIsSyncingHolidays(true);
      const year = selectedMonth.getFullYear();
      
      const response = await fetch('/api/admin/holidays/sync', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        credentials: 'include',
        body: JSON.stringify({ year }),
      });
      
      console.log('ë™ê¸°í™” API ì‘ë‹µ ìƒíƒœ:', response.status);
      
      if (!response.ok) {
        const errorData = await response.text();
        console.error('ë™ê¸°í™” API ì—ëŸ¬ ì‘ë‹µ:', errorData);
        throw new Error(`ë™ê¸°í™” ì‹¤íŒ¨: ${response.status} - ${errorData}`);
      }
      
      const result = await response.json();
      console.log('ë™ê¸°í™” ê²°ê³¼:', result);
      alert(`ê³µíœ´ì¼ ë™ê¸°í™” ì™„ë£Œ!\nìƒì„±: ${result.result.created}ê°œ\nì—…ë°ì´íŠ¸: ${result.result.updated}ê°œ`);
      await loadHolidays();
    } catch (error) {
      console.error('ê³µíœ´ì¼ ë™ê¸°í™” ì‹¤íŒ¨:', error);
      alert('ê³µíœ´ì¼ ë™ê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
    } finally {
      setIsSyncingHolidays(false);
    }
  };


  // ì¼ì • ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
  const loadEvents = async () => {
    try {
      setIsLoading(true);
      const year = selectedMonth.getFullYear();
      const month = selectedMonth.getMonth() + 1;
      
      const response = await fetch(`/api/admin/schedule?year=${year}&month=${month}`, {
        credentials: 'include'
      });
      
      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.error || 'ì¼ì •ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
      }
      
      const { events: data } = await response.json();
      
      // ë°ì´í„° í˜•ì‹ ë³€í™˜
      const formattedEvents = data.map((event: any) => ({
        id: event.id,
        date: event.date,
        endDate: event.end_date,
        title: event.title || eventTypeConfig[event.type as keyof typeof eventTypeConfig]?.label || '',
        type: event.type,
        description: event.description,
        startTime: event.start_time,
        endTime: event.end_time,
        isRecurring: event.is_recurring,
        recurringType: event.recurring_type,
        affectsReservation: event.affects_reservation,
        blockType: event.block_type,
        isAutoGenerated: event.is_auto_generated,
        sourceType: event.source_type
      }));
      
      setEvents(formattedEvents);
    } catch (error) {
      console.error('ì¼ì • ë¡œë“œ ì‹¤íŒ¨:', error);
      // ì—ëŸ¬ ì²˜ë¦¬ (í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ë“±)
    } finally {
      setIsLoading(false);
    }
  };

  // ì„ íƒëœ ì›”ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
  useEffect(() => {
    loadEvents();
    loadHolidays();
  }, [selectedMonth]);

  // ìº˜ë¦°ë” ë°ì´í„° ìƒì„±
  const generateCalendarDays = () => {
    const year = selectedMonth.getFullYear();
    const month = selectedMonth.getMonth();
    const firstDay = new Date(year, month, 1);
    // ì›”ìš”ì¼ë¶€í„° ì‹œì‘í•˜ë„ë¡ ê³„ì‚° (ì›”=0, í™”=1, ..., ì¼=6)
    const firstDayOfWeek = firstDay.getDay(); // 0=ì¼ìš”ì¼, 1=ì›”ìš”ì¼, ..., 6=í† ìš”ì¼
    const daysFromMonday = firstDayOfWeek === 0 ? 6 : firstDayOfWeek - 1; // ì¼ìš”ì¼ì´ë©´ 6, ë‚˜ë¨¸ì§€ëŠ” -1
    const startDate = new Date(year, month, 1 - daysFromMonday);
    
    const days = [];
    const current = new Date(startDate);
    
    // 6ì£¼ í‘œì‹œ (42ì¼)
    for (let i = 0; i < 42; i++) {
      days.push(new Date(current));
      current.setDate(current.getDate() + 1);
    }
    
    return days;
  };

  const formatDate = (date: Date) => {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
  };

  const getEventsForDate = (date: string) => {
    return events.filter(event => {
      // ë‹¨ì¼ ë‚ ì§œ ì´ë²¤íŠ¸
      if (!event.endDate) {
        return event.date === date;
      }
      
      // ê¸°ê°„ ì„¤ì •ëœ ì´ë²¤íŠ¸ - UTC íŒŒì‹± ë°©ì§€ë¥¼ ìœ„í•´ ë¡œì»¬ ì‹œê°„ìœ¼ë¡œ ì²˜ë¦¬
      const eventStart = new Date(event.date + 'T00:00:00');
      const eventEnd = new Date(event.endDate + 'T00:00:00');
      const checkDate = new Date(date + 'T00:00:00');
      
      return checkDate >= eventStart && checkDate <= eventEnd;
    });
  };

  // íŠ¹ì • ë‚ ì§œì˜ ê³µíœ´ì¼ ê°€ì ¸ì˜¤ê¸°
  const getHolidayForDate = (date: string) => {
    return holidays.find(holiday => holiday.date === date);
  };

  const handleSaveEvent = async (eventData: Partial<ScheduleEvent>) => {
    try {
      setIsLoading(true);
      
      // title ì„¤ì •
      const finalData = {
        ...eventData,
        title: eventData.type === 'event' 
          ? (eventData.title || eventTypeConfig.event.label)
          : eventTypeConfig[eventData.type as keyof typeof eventTypeConfig]?.label || ''
      };

      if (editingEvent) {
        // ìˆ˜ì •
        const response = await fetch('/api/admin/schedule', {
          method: 'PATCH',
          headers: {
            'Content-Type': 'application/json',
          },
          credentials: 'include',
          body: JSON.stringify({
            id: editingEvent.id,
            ...finalData
          }),
        });

        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.error || 'ì¼ì • ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
        }
      } else {
        // ìƒì„±
        const postData = {
          date: selectedDate || formatDate(new Date()),
          ...finalData
        };
        
        const response = await fetch('/api/admin/schedule', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          credentials: 'include',
          body: JSON.stringify(postData),
        });

        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.error || 'ì¼ì • ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
        }
      }
      
      // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
      await loadEvents();
      
      setIsAddingEvent(false);
      setEditingEvent(null);
      setSelectedDate(null);
    } catch (error) {
      console.error('ì¼ì • ì €ì¥ ì‹¤íŒ¨:', error);
      alert(error instanceof Error ? error.message : 'ì¼ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
    } finally {
      setIsLoading(false);
    }
  };

  const handleDeleteEvent = async (eventId: string) => {
    if (!confirm('ì´ ì¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
    
    try {
      setIsLoading(true);
      
      const response = await fetch(`/api/admin/schedule?id=${eventId}`, {
        method: 'DELETE',
        credentials: 'include'
      });

      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.error || 'ì¼ì • ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
      }
      
      // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
      await loadEvents();
    } catch (error) {
      console.error('ì¼ì • ì‚­ì œ ì‹¤íŒ¨:', error);
      alert(error instanceof Error ? error.message : 'ì¼ì • ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
    } finally {
      setIsLoading(false);
    }
  };

  const calendarDays = generateCalendarDays();

  // ì˜ˆì•½ ìŠ¤ì¼€ì¤„ ë™ê¸°í™” í•¨ìˆ˜
  const handleSyncReservationSchedules = async () => {
    if (!confirm('ì•ìœ¼ë¡œ 3ì£¼ê°„ì˜ ì˜ˆì•½ì„ ê¸°ë°˜ìœ¼ë¡œ ì¡°ê¸°/ë°¤ìƒ˜ì˜ì—… ìŠ¤ì¼€ì¤„ì„ ë™ê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nê¸°ì¡´ ìë™ìƒì„± ìŠ¤ì¼€ì¤„ì´ ì—…ë°ì´íŠ¸ë˜ê³ , ì˜ˆì•½ì´ ì—†ëŠ” ìŠ¤ì¼€ì¤„ì€ ì‚­ì œë©ë‹ˆë‹¤.')) {
      return;
    }
    
    try {
      setIsSyncingReservations(true);
      
      const response = await fetch('/api/admin/schedule/sync-reservations', {
        method: 'POST',
        credentials: 'include'
      });
      
      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.error || 'ì˜ˆì•½ ìŠ¤ì¼€ì¤„ ë™ê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
      }
      
      const result = await response.json();
      alert(`ì˜ˆì•½ ìŠ¤ì¼€ì¤„ ë™ê¸°í™” ì™„ë£Œ!\n\nì²˜ë¦¬ëœ ì˜ˆì•½: ${result.result.processed}ê°œ\nì •ë¦¬ëœ ë‚ ì§œ: ${result.result.cleaned}ê°œ\nì˜¤ë¥˜: ${result.result.errors}ê°œ\nê¸°ê°„: ${result.result.dateRange}`);
      
      // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
      await loadEvents();
    } catch (error) {
      console.error('ì˜ˆì•½ ìŠ¤ì¼€ì¤„ ë™ê¸°í™” ì‹¤íŒ¨:', error);
      alert(error instanceof Error ? error.message : 'ì˜ˆì•½ ìŠ¤ì¼€ì¤„ ë™ê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
    } finally {
      setIsSyncingReservations(false);
    }
  };

  // ì£¼ë§ ë°¤ìƒ˜ì˜ì—… ìë™ ìƒì„± í•¨ìˆ˜
  const handleGenerateWeekendSchedules = async () => {
    if (!confirm('í–¥í›„ 3ì£¼ê°„ì˜ ì£¼ë§ ë°¤ìƒ˜ì˜ì—… ì¼ì •ì„ ìë™ìœ¼ë¡œ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nê¸ˆìš”ì¼, í† ìš”ì¼ ë°¤ìƒ˜ì˜ì—…ì´ ìƒì„±ë©ë‹ˆë‹¤.')) {
      return;
    }
    
    try {
      setIsGeneratingWeekend(true);
      
      const response = await fetch('/api/v2/admin/schedule/generate-weekend', {
        method: 'POST',
        credentials: 'include'
      });
      
      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.error || 'ì£¼ë§ ë°¤ìƒ˜ì˜ì—… ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
      }
      
      const result = await response.json();
      alert(`ì£¼ë§ ë°¤ìƒ˜ì˜ì—… ìƒì„± ì™„ë£Œ!\n\nìƒì„±: ${result.result.created}ê°œ\nì´ë¯¸ ì¡´ì¬: ${result.result.skipped}ê°œ`);
      
      // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
      await loadEvents();
    } catch (error) {
      console.error('ì£¼ë§ ë°¤ìƒ˜ì˜ì—… ìƒì„± ì‹¤íŒ¨:', error);
      alert(error instanceof Error ? error.message : 'ì£¼ë§ ë°¤ìƒ˜ì˜ì—… ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
    } finally {
      setIsGeneratingWeekend(false);
    }
  };

  return (
    <div className="p-6 max-w-7xl mx-auto">
      {/* í—¤ë” */}
      <div className="mb-8">
        <h1 className="text-2xl font-bold dark:text-white mb-2">ìš´ì˜ ì¼ì • ê´€ë¦¬</h1>
        <p className="text-sm text-gray-600 dark:text-gray-400">
          íŠ¹ë³„ ìš´ì˜ ì‹œê°„, ë°¤ìƒ˜ ì˜ì—…, ì¡°ê¸° ë§ˆê°, ì´ë²¤íŠ¸ ë“±ì„ ê´€ë¦¬í•©ë‹ˆë‹¤
        </p>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {/* ìº˜ë¦°ë” */}
        <div className="lg:col-span-2">
          <div className="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6">
            {/* ìº˜ë¦°ë” í—¤ë” */}
            <div className="flex items-center justify-between mb-6">
              <button
                onClick={() => {
                  const newMonth = new Date(selectedMonth);
                  newMonth.setMonth(newMonth.getMonth() - 1);
                  setSelectedMonth(newMonth);
                }}
                className="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"
              >
                <ChevronLeft className="w-5 h-5 text-gray-700 dark:text-gray-300" />
              </button>
              
              <h2 className="text-lg font-semibold dark:text-white">
                {selectedMonth.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long' })}
              </h2>
              
              <button
                onClick={() => {
                  const newMonth = new Date(selectedMonth);
                  newMonth.setMonth(newMonth.getMonth() + 1);
                  setSelectedMonth(newMonth);
                }}
                className="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"
              >
                <ChevronRight className="w-5 h-5 text-gray-700 dark:text-gray-300" />
              </button>
            </div>

            {/* ìš”ì¼ í—¤ë” */}
            <div className="grid grid-cols-7 gap-1 mb-2">
              {['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'].map(day => (
                <div key={day} className="text-center text-sm font-medium text-gray-600 dark:text-gray-400 py-2">
                  {day}
                </div>
              ))}
            </div>

            {/* ë‚ ì§œ ê·¸ë¦¬ë“œ */}
            {isLoading ? (
              <div className="flex justify-center items-center h-96">
                <Loader2 className="w-8 h-8 animate-spin text-gray-400" />
              </div>
            ) : (
            <div className="grid grid-cols-7 gap-1">
              {calendarDays.map((date, index) => {
                const dateStr = formatDate(date);
                const dayEvents = dateStr ? getEventsForDate(dateStr) : [];
                const holiday = dateStr ? getHolidayForDate(dateStr) : null;
                const isCurrentMonth = date.getMonth() === selectedMonth.getMonth();
                const isToday = formatDate(new Date()) === dateStr;
                const dayOfWeek = date.getDay();
                const isSunday = dayOfWeek === 0;
                const isSaturday = dayOfWeek === 6;
                
                // ë‚ ì§œ ìƒ‰ìƒ ê²°ì • (ê¸€ì”¨ë§Œ ë¹¨ê°„ìƒ‰)
                let dateColor = '';
                if (holiday?.is_red_day) {
                  // ê³µíœ´ì¼
                  if (holiday.type === 'temporary') {
                    dateColor = 'text-orange-600 font-bold'; // ì„ì‹œê³µíœ´ì¼
                  } else {
                    dateColor = 'text-red-600 font-bold'; // ê³µì‹ ê³µíœ´ì¼
                  }
                } else if (isSunday) {
                  dateColor = 'text-red-600'; // ì¼ìš”ì¼
                } else if (isSaturday) {
                  dateColor = 'text-blue-600'; // í† ìš”ì¼
                }
                
                return (
                  <motion.div
                    key={index}
                    initial={{ opacity: 0, scale: 0.9 }}
                    animate={{ opacity: 1, scale: 1 }}
                    transition={{ delay: index * 0.01 }}
                    className={`min-h-[80px] p-2 border rounded-lg cursor-pointer transition-colors ${
                      isCurrentMonth
                        ? 'bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800'
                        : 'bg-gray-50 dark:bg-gray-950 border-gray-100 dark:border-gray-800 text-gray-400 dark:text-gray-600'
                    } ${isToday ? 'ring-2 ring-blue-500' : ''}`}
                    onClick={() => {
                      if (isCurrentMonth && dateStr) {
                        // ì´ë²¤íŠ¸ê°€ ìˆìœ¼ë©´ í•´ë‹¹ ë‚ ì§œì˜ ëª¨ë“  ì´ë²¤íŠ¸ ëª©ë¡ì„ ë³´ì—¬ì£¼ê³ ,
                        // ì—†ìœ¼ë©´ ìƒˆ ì¼ì • ì¶”ê°€ ëª¨ë‹¬ì„ ì—°ë‹¤
                        if (dayEvents.length > 0) {
                          setSelectedDate(dateStr);
                          setShowDateEventsModal(true);
                        } else {
                          setSelectedDate(dateStr);
                          setIsAddingEvent(true);
                        }
                      }
                    }}
                    title={holiday ? holiday.name : ''}
                  >
                    <div className={`text-sm font-medium mb-1 ${isCurrentMonth ? dateColor : ''}`}>
                      {date.getDate()}
                      {holiday && (
                        <span className="ml-1 text-xs">
                          {holiday.type === 'temporary' && 'ğŸŸ '}
                        </span>
                      )}
                    </div>
                    <div className="space-y-1">
                      {dayEvents.slice(0, 2).map(event => {
                        const config = eventTypeConfig[event.type];
                        const Icon = config.icon;
                        return (
                          <div
                            key={event.id}
                            className={`text-xs px-1 py-0.5 rounded flex items-center gap-1 ${config.color} cursor-pointer`}
                            onClick={(e) => {
                              e.stopPropagation();
                              setSelectedDate(event.date);
                              setShowDateEventsModal(true);
                            }}
                          >
                            <Icon className="w-3 h-3" />
                            <span className="truncate">
                              {event.title}
                              </span>
                          </div>
                        );
                      })}
                      {dayEvents.length > 2 && (
                        <div className="text-xs text-gray-500 dark:text-gray-500">
                          +{dayEvents.length - 2}ê°œ
                        </div>
                      )}
                    </div>
                  </motion.div>
                );
              })}
            </div>
            )}
          </div>
        </div>

        {/* ì´ë²¤íŠ¸ ëª©ë¡ ë° ì¶”ê°€ */}
        <div className="space-y-6">
          {/* ì´ë²¤íŠ¸ ì¶”ê°€ ë²„íŠ¼ë“¤ */}
          <div className="space-y-3">
            <button
              onClick={() => setIsAddingEvent(true)}
              className="w-full py-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl hover:border-gray-400 dark:hover:border-gray-500 transition-colors flex items-center justify-center gap-2 text-gray-600 dark:text-gray-400"
            >
              <Plus className="w-5 h-5" />
              <span>ìƒˆ ì¼ì • ì¶”ê°€</span>
            </button>
            
            <button
              onClick={syncHolidays}
              disabled={isSyncingHolidays}
              className="w-full py-4 bg-red-600 hover:bg-red-700 disabled:bg-red-400 text-white rounded-xl transition-colors flex items-center justify-center gap-2 font-medium"
            >
              {isSyncingHolidays ? (
                <>
                  <Loader2 className="w-5 h-5 animate-spin" />
                  <span>ë™ê¸°í™” ì¤‘...</span>
                </>
              ) : (
                <>
                  <Calendar className="w-5 h-5" />
                  <span>ê³µíœ´ì¼ ë™ê¸°í™”</span>
                </>
              )}
            </button>
            
            <button
              onClick={handleGenerateWeekendSchedules}
              disabled={isGeneratingWeekend}
              className="w-full py-4 bg-purple-600 hover:bg-purple-700 disabled:bg-purple-400 text-white rounded-xl transition-colors flex items-center justify-center gap-2 font-medium"
            >
              {isGeneratingWeekend ? (
                <>
                  <Loader2 className="w-5 h-5 animate-spin" />
                  <span>ìƒì„± ì¤‘...</span>
                </>
              ) : (
                <>
                  <CalendarPlus className="w-5 h-5" />
                  <span>ì£¼ë§ ë°¤ìƒ˜ì˜ì—… 3ì£¼ì¹˜ ìƒì„±</span>
                </>
              )}
            </button>
            
            <button
              onClick={handleSyncReservationSchedules}
              disabled={isSyncingReservations}
              className="w-full py-4 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white rounded-xl transition-colors flex items-center justify-center gap-2 font-medium"
            >
              {isSyncingReservations ? (
                <>
                  <Loader2 className="w-5 h-5 animate-spin" />
                  <span>ë™ê¸°í™” ì¤‘...</span>
                </>
              ) : (
                <>
                  <RefreshCw className="w-5 h-5" />
                  <span>ì˜ˆì•½ ìŠ¤ì¼€ì¤„ ë™ê¸°í™”</span>
                </>
              )}
            </button>
          </div>

          {/* ê³µíœ´ì¼ ë™ê¸°í™” ìƒíƒœ */}
          <div className="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4">
            <h3 className="font-medium dark:text-white mb-3">ê³µíœ´ì¼ ì •ë³´</h3>
            <div className="space-y-2">
              <div className="flex items-center gap-2">
                <div className="w-3 h-3 bg-red-600 rounded-full"></div>
                <span className="text-sm text-gray-600 dark:text-gray-400">ê³µì‹ ê³µíœ´ì¼</span>
              </div>
              <div className="flex items-center gap-2">
                <div className="w-3 h-3 bg-orange-600 rounded-full"></div>
                <span className="text-sm text-gray-600 dark:text-gray-400">ì„ì‹œ ê³µíœ´ì¼</span>
              </div>
              <div className="flex items-center gap-2">
                <div className="w-3 h-3 border-2 border-red-600 border-dashed rounded-full"></div>
                <span className="text-sm text-gray-600 dark:text-gray-400">ëŒ€ì²´ ê³µíœ´ì¼</span>
              </div>
              {lastSyncTime && (
                <div className="mt-3 pt-3 border-t border-gray-200 dark:border-gray-700">
                  <p className="text-xs text-gray-500 dark:text-gray-500">
                    ë§ˆì§€ë§‰ ë™ê¸°í™”: {lastSyncTime.toLocaleString('ko-KR')}
                  </p>
                </div>
              )}
            </div>
          </div>

          {/* ì´ë²¤íŠ¸ íƒ€ì…ë³„ ë²”ë¡€ */}
          <div className="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4">
            <h3 className="font-medium dark:text-white mb-3">ì¼ì • ìœ í˜•</h3>
            <div className="space-y-2">
              {Object.entries(eventTypeConfig).map(([type, config]) => {
                const Icon = config.icon;
                return (
                  <div key={type} className="flex items-center gap-3">
                    <div className={`p-1.5 rounded ${config.color}`}>
                      <Icon className="w-4 h-4" />
                    </div>
                    <span className="text-sm text-gray-600 dark:text-gray-400">{config.label}</span>
                  </div>
                );
              })}
            </div>
          </div>

          {/* ì´ë²ˆ ë‹¬ ì¼ì • ìš”ì•½ */}
          <div className="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4">
            <h3 className="font-medium dark:text-white mb-3">ì´ë²ˆ ë‹¬ ì¼ì •</h3>
            <div className="space-y-2 max-h-64 overflow-y-auto">
              {events
                .filter(event => {
                  const eventDate = new Date(event.date);
                  return eventDate.getMonth() === selectedMonth.getMonth() &&
                         eventDate.getFullYear() === selectedMonth.getFullYear();
                })
                .sort((a, b) => a.date.localeCompare(b.date))
                .map(event => {
                  const config = eventTypeConfig[event.type];
                  const Icon = config.icon;
                  return (
                    <div
                      key={event.id}
                      className="flex items-center justify-between p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer"
                      onClick={() => setEditingEvent(event)}
                    >
                      <div className="flex items-center gap-2">
                        <Icon className={`w-4 h-4 ${config.color.split(' ')[0]}`} />
                        <div>
                          <div className="text-sm font-medium dark:text-white">
                            {new Date(event.date).getDate()}ì¼
                            {event.endDate && ` ~ ${new Date(event.endDate).getDate()}ì¼`}
                            {' - '}{event.title}
                          </div>
                          {event.type === 'reservation_block' && event.blockType && (
                            <div className="text-xs text-gray-500 dark:text-gray-500">
                              {event.blockType === 'early' && 'ì¡°ê¸° ëŒ€ì—¬ ì œí•œ'}
                              {event.blockType === 'overnight' && 'ë°¤ìƒ˜ ëŒ€ì—¬ ì œí•œ'}
                              {event.blockType === 'all_day' && 'ì¢…ì¼ ì˜ˆì•½ ì œí•œ'}
                            </div>
                          )}
                          {event.startTime && event.type !== 'reservation_block' && (
                            <div className="text-xs text-gray-500 dark:text-gray-500">
                              {event.type === 'early_open' ? 
                                event.startTime.slice(0, 5) : 
                                `${event.startTime.slice(0, 5)} ~ ${event.endTime?.slice(0, 5)}`
                              }
                            </div>
                          )}
                        </div>
                      </div>
                      <ChevronRight className="w-4 h-4 text-gray-400" />
                    </div>
                  );
                })}
            </div>
          </div>
        </div>
      </div>

      {/* ì¼ì • ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ */}
      <AnimatePresence>
      {(isAddingEvent || editingEvent) && (
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }} 
          className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50"
          onClick={() => {
            setIsAddingEvent(false);
            setEditingEvent(null);
            setSelectedDate(null);
          }}
        >
          <motion.div
            initial={{ opacity: 0, scale: 0.9 }}
            animate={{ opacity: 1, scale: 1 }}
            exit={{ opacity: 0, scale: 0.9 }}
            className="bg-white dark:bg-gray-900 rounded-2xl p-6 max-w-md w-full max-h-[90vh] overflow-y-auto"
            onClick={(e) => e.stopPropagation()}
          >
            <h2 className="text-xl font-semibold dark:text-white mb-6">
              {editingEvent ? 'ì¼ì • ìˆ˜ì •' : 'ìƒˆ ì¼ì • ì¶”ê°€'}
            </h2>
            
            <EventForm
              event={editingEvent || { date: selectedDate || formatDate(new Date()) || '' }}
              onSave={handleSaveEvent}
              onCancel={() => {
                setIsAddingEvent(false);
                setEditingEvent(null);
                setSelectedDate(null);
              }}
              onDelete={editingEvent ? (eventId: string) => {
                handleDeleteEvent(eventId);
                setEditingEvent(null);
              } : undefined}
            />
          </motion.div>
        </motion.div>
      )}
      </AnimatePresence>

      {/* ë‚ ì§œë³„ ì´ë²¤íŠ¸ ëª©ë¡ ëª¨ë‹¬ */}
      <AnimatePresence>
        {showDateEventsModal && selectedDate && (
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50"
            onClick={() => setShowDateEventsModal(false)}
          >
            <motion.div
              initial={{ opacity: 0, scale: 0.9 }}
              animate={{ opacity: 1, scale: 1 }}
              exit={{ opacity: 0, scale: 0.9 }}
              className="bg-white dark:bg-gray-900 rounded-2xl shadow-2xl max-w-md w-full max-h-[80vh] overflow-y-auto"
              onClick={(e) => e.stopPropagation()}
            >
              <div className="sticky top-0 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 p-6 rounded-t-2xl">
                <div className="flex items-center justify-between">
                  <h2 className="text-xl font-semibold dark:text-white">
                    {new Date(selectedDate + 'T00:00:00').toLocaleDateString('ko-KR', { 
                      month: 'long', 
                      day: 'numeric' 
                    })} ì¼ì •
                  </h2>
                  <button
                    onClick={() => setShowDateEventsModal(false)}
                    className="p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors"
                  >
                    <X className="w-5 h-5 text-gray-700 dark:text-gray-300" />
                  </button>
                </div>
                <p className="text-sm text-gray-600 dark:text-gray-400 mt-1">
                  ì´ {events.filter(e => e.date === selectedDate).length}ê°œì˜ ì¼ì •ì´ ìˆìŠµë‹ˆë‹¤
                </p>
              </div>
              
              <div className="p-6">
                {events.filter(e => e.date === selectedDate).length === 0 ? (
                  <div className="text-center py-8 text-gray-500 dark:text-gray-400">
                    ì„ íƒí•œ ë‚ ì§œì— ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤
                  </div>
                ) : (
                  <div className="space-y-3">
                    {events
                      .filter(e => e.date === selectedDate)
                      .map((event) => {
                        const config = eventTypeConfig[event.type];
                        const Icon = config.icon;
                        
                        return (
                          <button
                            key={event.id}
                            onClick={() => {
                              setShowDateEventsModal(false);
                              setEditingEvent(event);
                            }}
                            className={`w-full p-4 rounded-xl border ${config.borderColor} ${config.color} hover:shadow-md transition-all text-left group`}
                          >
                            <div className="flex items-start justify-between gap-3">
                              <div className="flex items-start gap-3">
                                <div className="mt-1">
                                  <Icon className="w-5 h-5" />
                                </div>
                                <div className="flex-1">
                                  <h3 className="font-medium text-gray-900 dark:text-white mb-1">
                                    {event.title || config.label}
                                    {event.isAutoGenerated && (
                                      <span className="ml-2 text-xs px-2 py-0.5 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded-full">
                                        ìë™ìƒì„±
                                      </span>
                                    )}
                                  </h3>
                                  {event.description && (
                                    <p className="text-sm text-gray-600 dark:text-gray-400 line-clamp-2">
                                      {event.description}
                                    </p>
                                  )}
                                  {event.startTime && (
                                    <p className="text-sm text-gray-600 dark:text-gray-400 mt-1">
                                      {event.type === 'early_open' ? 
                                        formatTime24Hour(event.startTime) : 
                                        `${formatTime24Hour(event.startTime)} ~ ${formatTime24Hour(event.endTime || '')}`
                                      }
                                    </p>
                                  )}
                                  {event.type === 'reservation_block' && event.blockType && (
                                    <p className="text-sm font-medium mt-1">
                                      {event.blockType === 'early' && 'ì¡°ê¸° ëŒ€ì—¬ ì œí•œ'}
                                      {event.blockType === 'overnight' && 'ë°¤ìƒ˜ ëŒ€ì—¬ ì œí•œ'}
                                      {event.blockType === 'all_day' && 'ì¢…ì¼ ì˜ˆì•½ ì œí•œ'}
                                    </p>
                                  )}
                                </div>
                              </div>
                              <ChevronRight className="w-5 h-5 text-gray-400 dark:text-gray-600 opacity-0 group-hover:opacity-100 transition-opacity" />
                            </div>
                          </button>
                        );
                      })}
                  </div>
                )}
                
                <button
                  onClick={() => {
                    setShowDateEventsModal(false);
                    setIsAddingEvent(true);
                  }}
                  className="w-full mt-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium flex items-center justify-center gap-2"
                >
                  <Plus className="w-5 h-5" />
                  ìƒˆ ì¼ì • ì¶”ê°€
                </button>
              </div>
            </motion.div>
          </motion.div>
        )}
      </AnimatePresence>


      {/* ì•ˆë‚´ ë©”ì‹œì§€ */}
      <div className="mt-6 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-4">
        <div className="flex items-start gap-3">
          <AlertCircle className="w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5" />
          <div>
            <h4 className="font-medium text-blue-800 dark:text-blue-200 mb-1">
              ìš´ì˜ ì¼ì • ê´€ë¦¬ ì•ˆë‚´
            </h4>
            <ul className="text-sm text-blue-700 dark:text-blue-300 space-y-1">
              <li>â€¢ 'ì˜ˆì•½ ì˜í–¥' ì˜µì…˜ì„ ì²´í¬í•˜ë©´ í•´ë‹¹ ë‚ ì§œì˜ ì˜ˆì•½ì´ ì œí•œë©ë‹ˆë‹¤</li>
              <li>â€¢ íŠ¹ë³„ ìš´ì˜ ì‹œê°„ì€ ì¼ë°˜ ìš´ì˜ ì‹œê°„ì„ ë®ì–´ì”ë‹ˆë‹¤</li>
              <li>â€¢ ë°¤ìƒ˜ ì˜ì—…ì€ ë‹¤ìŒë‚  ìƒˆë²½ê¹Œì§€ ìš´ì˜ ì‹œê°„ì„ ì—°ì¥í•©ë‹ˆë‹¤</li>
              <li>â€¢ ì¡°ê¸° ë§ˆê°ì€ ì˜ì—… ì‹œê°„ì„ ë‹¨ì¶•í•©ë‹ˆë‹¤</li>
              <li>â€¢ ì£¼ë§ ë°¤ìƒ˜ì˜ì—… ìë™ ìƒì„±: ê¸ˆìš”ì¼, í† ìš”ì¼ ë°¤ â†’ 29ì‹œ(05:00)ê¹Œì§€ ì˜ì—…</li>
              <li>â€¢ ì˜ˆì•½ ìŠ¤ì¼€ì¤„ ë™ê¸°í™”: ìŠ¹ì¸ëœ ì˜ˆì•½ì„ ê¸°ë°˜ìœ¼ë¡œ ì¡°ê¸°/ë°¤ìƒ˜ì˜ì—… ìë™ ìƒì„±/ì‚­ì œ</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  );
}

// ì´ë²¤íŠ¸ í¼ ì»´í¬ë„ŒíŠ¸
function EventForm({ 
  event, 
  onSave, 
  onCancel,
  onDelete
}: {
  event: Partial<ScheduleEvent> & { date: string };
  onSave: (event: Partial<ScheduleEvent>) => void;
  onCancel: () => void;
  onDelete?: (eventId: string) => void;
}) {
  // íƒ€ì…ë³„ë¡œ ì‹œê°„ì„ ì´ˆê¸°í™” (ìˆ˜ì • ì‹œì—ë„ ìœ ì§€)
  const getInitialTimes = () => {
    if (event.id) {
      // ìˆ˜ì • ëª¨ë“œì¼ ë•ŒëŠ” ê¸°ì¡´ ê°’ ìœ ì§€
      return {
        startTime: event.startTime || '',
        endTime: event.endTime || ''
      };
    }
    // ìƒˆë¡œ ìƒì„±í•  ë•Œë§Œ ì´ˆê¸°í™”
    switch (event.type) {
      case 'early_open':
        return { startTime: '', endTime: '' };
      case 'early_close':
        return { startTime: '', endTime: '' };
      case 'overnight':
        return { startTime: '', endTime: '' };
      default:
        return { startTime: '', endTime: '' };
    }
  };

  const initialTimes = getInitialTimes();
  
  const [formData, setFormData] = useState({
    date: event.date || '',
    endDate: event.endDate || '',
    type: event.type || 'early_open',
    title: event.title || '',
    description: event.description || '',
    startTime: initialTimes.startTime,
    endTime: initialTimes.endTime,
    affectsReservation: event.affectsReservation ?? (event.type === 'reservation_block'),
    blockType: event.blockType || 'all_day'
  });
  const [isPeriod, setIsPeriod] = useState(!!event.endDate);
  const [isAllDay, setIsAllDay] = useState(!event.startTime && !event.endTime);
  const [blockOptions, setBlockOptions] = useState({
    early: event.blockType === 'early' || event.blockType === 'all_day',
    overnight: event.blockType === 'overnight' || event.blockType === 'all_day'
  });

  // ì¡°ê¸°/ë°¤ìƒ˜ ë‘˜ ë‹¤ ì„ íƒì‹œ ìë™ìœ¼ë¡œ ì¢…ì¼ ì„ íƒ
  useEffect(() => {
    if (formData.type === 'reservation_block') {
      if (blockOptions.early && blockOptions.overnight) {
        setFormData({ ...formData, blockType: 'all_day', affectsReservation: true });
      } else if (blockOptions.early) {
        setFormData({ ...formData, blockType: 'early', affectsReservation: true });
      } else if (blockOptions.overnight) {
        setFormData({ ...formData, blockType: 'overnight', affectsReservation: true });
      }
    }
  }, [blockOptions, formData.type]);

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    const dataToSave: any = { ...formData };
    if (!isPeriod) {
      delete dataToSave.endDate;
    }
    // ì˜ˆì•½ ì œí•œì€ ë¬´ì¡°ê±´ ì˜ˆì•½ì— ì˜í–¥
    if (dataToSave.type === 'reservation_block') {
      dataToSave.affectsReservation = true;
    }
    onSave(dataToSave);
  };

  return (
    <form onSubmit={handleSubmit} className="space-y-4">
      <div>
        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          ë‚ ì§œ
        </label>
        <div className="space-y-2">
          <input
            type="date"
            value={formData.date}
            onChange={(e) => setFormData({ ...formData, date: e.target.value })}
            className="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            required
          />
          <label className="flex items-center gap-2">
            <input
              type="checkbox"
              checked={isPeriod}
              onChange={(e) => {
                setIsPeriod(e.target.checked);
                if (!e.target.checked) {
                  setFormData({ ...formData, endDate: '' });
                }
              }}
              className="text-blue-600 rounded focus:ring-blue-500"
            />
            <span className="text-sm text-gray-700 dark:text-gray-300">ê¸°ê°„ ì„¤ì •</span>
          </label>
          {isPeriod && (
            <input
              type="date"
              value={formData.endDate}
              onChange={(e) => setFormData({ ...formData, endDate: e.target.value })}
              min={formData.date}
              className="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              placeholder="ì¢…ë£Œ ë‚ ì§œ"
              required
            />
          )}
        </div>
      </div>

      <div>
        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          ì¼ì • ìœ í˜•
        </label>
        <select
          value={formData.type}
          onChange={(e) => {
            const newType = e.target.value as ScheduleEvent['type'];
            setFormData({ 
              ...formData, 
              type: newType,
              affectsReservation: newType === 'reservation_block'
            });
          }}
          className={`w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent ${
            event.id ? 'opacity-60 cursor-not-allowed' : ''
          }`}
          disabled={!!event.id}
        >
          {Object.entries(eventTypeConfig).map(([type, config]) => (
            <option key={type} value={type}>{config.label}</option>
          ))}
        </select>
        {event.id && (
          <p className="text-sm text-gray-500 dark:text-gray-400 mt-1">
            * ìˆ˜ì • ì‹œ ì¼ì • ìœ í˜•ì€ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤
          </p>
        )}
      </div>

      {formData.type === 'event' && (
        <div>
          <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            ì´ë²¤íŠ¸ ì œëª©
          </label>
          <input
            type="text"
            value={formData.title}
            onChange={(e) => setFormData({ ...formData, title: e.target.value })}
            className="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="ì˜ˆ: ì‹ ê·œ ê¸°ê¸° ì˜¤í”ˆ ì´ë²¤íŠ¸"
            required={formData.type === 'event'}
          />
        </div>
      )}

      <div>
        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          ì„¤ëª… (ì„ íƒ)
        </label>
        <textarea
          value={formData.description}
          onChange={(e) => setFormData({ ...formData, description: e.target.value })}
          className="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          rows={3}
          placeholder="ì˜ˆ: ê¸°ê¸° ì ê²€ìœ¼ë¡œ ì¸í•œ ì¡°ê¸° ë§ˆê°"
        />
      </div>

      {formData.type === 'reservation_block' && (
        <div>
          <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            ì˜ˆì•½ ì œí•œ ë²”ìœ„
          </label>
          <div className="space-y-2">
            <label className="flex items-center gap-3 p-3 border border-gray-200 dark:border-gray-700 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800">
              <input
                type="checkbox"
                checked={blockOptions.early}
                onChange={(e) => setBlockOptions({ ...blockOptions, early: e.target.checked })}
                className="text-blue-600 rounded focus:ring-blue-500"
              />
              <span className="text-sm font-medium dark:text-white">ì¡°ê¸° ëŒ€ì—¬ ì œí•œ</span>
            </label>
            <label className="flex items-center gap-3 p-3 border border-gray-200 dark:border-gray-700 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800">
              <input
                type="checkbox"
                checked={blockOptions.overnight}
                onChange={(e) => setBlockOptions({ ...blockOptions, overnight: e.target.checked })}
                className="text-blue-600 rounded focus:ring-blue-500"
              />
              <span className="text-sm font-medium dark:text-white">ë°¤ìƒ˜ ëŒ€ì—¬ ì œí•œ</span>
            </label>
            {blockOptions.early && blockOptions.overnight && (
              <div className="p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg">
                <p className="text-sm text-red-700 dark:text-red-300">
                  âš ï¸ ì¡°ê¸°ì™€ ë°¤ìƒ˜ ëª¨ë‘ ì œí•œì‹œ ì¢…ì¼ ì˜ˆì•½ì´ ì°¨ë‹¨ë©ë‹ˆë‹¤
                </p>
              </div>
            )}
          </div>
        </div>
      )}

      {/* íŠ¹ë³„ ìš´ì˜, ì´ë²¤íŠ¸ - ì¢…ì¼ ì˜µì…˜ê³¼ ì‹œì‘/ì¢…ë£Œ ì‹œê°„ */}
      {(formData.type === 'special' || formData.type === 'event') && (
        <div>
          <label className="flex items-center gap-2 mb-3">
            <input
              type="checkbox"
              checked={isAllDay}
              onChange={(e) => {
                setIsAllDay(e.target.checked);
                if (e.target.checked) {
                  setFormData({ ...formData, startTime: '', endTime: '' });
                }
              }}
              className="text-blue-600 rounded focus:ring-blue-500"
            />
            <span className="text-sm font-medium text-gray-700 dark:text-gray-300">ì¢…ì¼</span>
          </label>
          {!isAllDay && (
            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                  ì‹œì‘ ì‹œê°„
                </label>
                <input
                  type="time"
                  value={formData.startTime}
                  onChange={(e) => setFormData({ ...formData, startTime: e.target.value })}
                  step="3600"
                  className="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                  ì¢…ë£Œ ì‹œê°„
                </label>
                <input
                  type="time"
                  value={formData.endTime}
                  onChange={(e) => setFormData({ ...formData, endTime: e.target.value })}
                  step="3600"
                  className="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>
            </div>
          )}
        </div>
      )}

      {/* ì¡°ê¸° ì˜ì—… - ì‹œì‘ ì‹œê°„ë§Œ */}
      {formData.type === 'early_open' && (
        <div>
          <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
            ì˜¤í”ˆ ì‹œê°„
          </label>
          <div className="grid grid-cols-3 gap-2">
            {[7, 8, 9, 10, 11, 12].map((hour) => (
              <button
                key={hour}
                type="button"
                onClick={() => setFormData({ ...formData, startTime: `${hour.toString().padStart(2, '0')}:00` })}
                className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                  formData.startTime === `${hour.toString().padStart(2, '0')}:00` || 
                  formData.startTime === `${hour.toString().padStart(2, '0')}:00:00`
                    ? 'bg-blue-600 text-white hover:bg-blue-700'
                    : 'bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 border border-gray-300 dark:border-gray-600'
                }`}
              >
                {hour}ì‹œ
              </button>
            ))}
          </div>
          <p className="text-xs text-gray-500 dark:text-gray-400 mt-2">
            í‰ì†Œë³´ë‹¤ ì¼ì° ì˜ì—…ì„ ì‹œì‘í•˜ëŠ” ì‹œê°„
          </p>
        </div>
      )}

      {/* ì¡°ê¸° ë§ˆê° - ì¢…ë£Œ ì‹œê°„ë§Œ */}
      {formData.type === 'early_close' && (
        <div>
          <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
            ë§ˆê° ì‹œê°„
          </label>
          <div className="grid grid-cols-3 gap-2">
            {[21, 22, 23].map((hour) => (
              <button
                key={hour}
                type="button"
                onClick={() => setFormData({ ...formData, endTime: `${hour}:00` })}
                className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                  formData.endTime === `${hour}:00` ||
                  formData.endTime === `${hour}:00:00`
                    ? 'bg-orange-600 text-white hover:bg-orange-700'
                    : 'bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 border border-gray-300 dark:border-gray-600'
                }`}
              >
                {hour}ì‹œ
              </button>
            ))}
          </div>
          <p className="text-xs text-gray-500 dark:text-gray-400 mt-2">
            í‰ì†Œë³´ë‹¤ ì¼ì° ì˜ì—…ì„ ì¢…ë£Œí•˜ëŠ” ì‹œê°„
          </p>
        </div>
      )}

      {/* ë°¤ìƒ˜ ì˜ì—… - ì¢…ë£Œ ì‹œê°„ë§Œ */}
      {formData.type === 'overnight' && (
        <div>
          <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
            ì¢…ë£Œ ì‹œê°„ (ë‹¤ìŒë‚  ìƒˆë²½)
          </label>
          <div className="grid grid-cols-2 gap-2">
            <button
              type="button"
              onClick={() => setFormData({ ...formData, endTime: '04:00' })}
              className={`py-3 px-4 rounded-lg font-medium transition-colors ${
                formData.endTime === '04:00' || formData.endTime === '04:00:00'
                  ? 'bg-purple-600 text-white hover:bg-purple-700'
                  : 'bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 border border-gray-300 dark:border-gray-600'
              }`}
            >
              28ì‹œ<br/>
              <span className="text-xs opacity-75">(ìƒˆë²½ 4ì‹œ)</span>
            </button>
            <button
              type="button"
              onClick={() => setFormData({ ...formData, endTime: '05:00' })}
              className={`py-3 px-4 rounded-lg font-medium transition-colors ${
                formData.endTime === '05:00' || formData.endTime === '05:00:00'
                  ? 'bg-purple-600 text-white hover:bg-purple-700'
                  : 'bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 border border-gray-300 dark:border-gray-600'
              }`}
            >
              29ì‹œ<br/>
              <span className="text-xs opacity-75">(ìƒˆë²½ 5ì‹œ)</span>
            </button>
          </div>
          <p className="text-xs text-gray-500 dark:text-gray-400 mt-2">
            ë‹¤ìŒë‚  ìƒˆë²½ê¹Œì§€ ìš´ì˜í•˜ëŠ” ì¢…ë£Œ ì‹œê°„
          </p>
        </div>
      )}


      <div className="space-y-3">
        <div className="flex gap-3">
          <button
            type="button"
            onClick={onCancel}
            className="flex-1 py-2 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors"
          >
            ì·¨ì†Œ
          </button>
          <button
            type="submit"
            className="flex-1 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors"
          >
            ì €ì¥
          </button>
        </div>
        {onDelete && event.id && (
          <button
            type="button"
            onClick={() => onDelete(event.id!)}
            className="w-full py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors flex items-center justify-center gap-2"
          >
            <Trash2 className="w-4 h-4" />
            ì‚­ì œ
          </button>
        )}
      </div>
    </form>
  );
}